<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>League Player Lookup</title>
<style>
body {
  background:#0a0a0a; color:#0f0; font-family:'Orbitron', monospace;
  padding:30px; text-align:center;
}
h3 { margin-bottom:20px; }
.search-box {
  display:flex; justify-content:center; gap:10px; margin-bottom:25px;
}
input {
  width:280px; padding:10px; background:#111; color:#0f0;
  border:1px solid #0f0; font-size:15px; border-radius:4px;
}
button {
  padding:10px 20px; background:#0f0; color:#000;
  border:none; cursor:pointer; font-weight:bold;
  border-radius:4px; transition:0.2s;
}
button:hover { background:#0ff; }
#card {
  display:inline-block; background:#111; border:1px solid #0f0;
  padding:20px; border-radius:10px; text-align:left;
  color:#0f0; max-width:380px; margin:auto;
}
.player-img {
  display:block; width:120px; height:120px;
  border-radius:50%; margin:0 auto 15px auto;
  border:2px solid #0f0; object-fit:cover;
}
.stat { margin:4px 0; }
.error { color:#f33; margin-top:20px; }
.loading { color:#ff0; margin-top:20px; }
</style>
</head>
<body>
<h3>League of Graphs â€“ NA Player Search</h3>

<div class="search-box">
  <input id="summoner" placeholder="Enter summoner name (e.g. cant type-1998)"
         onkeypress="if(event.key==='Enter')runScrape()">
  <button onclick="runScrape()">Search</button>
</div>

<div id="card"></div>
<div id="status"></div>

<script>
async function fetchProfile(name) {
  const url = `https://www.leagueofgraphs.com/summoner/na/${encodeURIComponent(name)}`;
  const proxied = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
  const res = await fetch(proxied);
  if (!res.ok) throw new Error("Failed to load player page");
  const html = await res.text();
  if (!html.includes("<html")) throw new Error("Invalid HTML response");
  return html;
}

async function runScrape() {
  const name = document.getElementById("summoner").value.trim();
  const card = document.getElementById("card");
  const status = document.getElementById("status");

  if (!name) {
    status.textContent = "Enter a summoner name first.";
    status.className = "error";
    return;
  }
  card.innerHTML = "";
  status.textContent = "Fetching data...";
  status.className = "loading";

  try {
    const html = await fetchProfile(name);
    const doc = new DOMParser().parseFromString(html, "text/html");

    // --- Extract main profile fields ---
    const level = doc.querySelector(".bannerSubtitle")?.textContent.replace("Level","").trim() || "Unknown";
    const rankTier = doc.querySelector(".leagueTier")?.textContent.trim() || "Unranked";
    const lp = doc.querySelector(".leaguePoints")?.textContent.trim() || "";
    const wins = doc.querySelector(".wins")?.textContent.replace("Wins:","").trim() || "0";
    const losses = doc.querySelector(".losses")?.textContent.replace("Losses:","").trim() || "0";
    const ratio = doc.querySelector(".ratio")?.textContent.trim() || "";
    const img = doc.querySelector(".bannerImage img")?.src || "";

    const champs = Array.from(doc.querySelectorAll(".summoner-champion-name"))
      .slice(0,3)
      .map(el => el.textContent.trim());

    // --- Build pretty card ---
    let htmlOut = "";
    if (img) htmlOut += `<img class="player-img" src="${img}" alt="${name}">`;
    htmlOut += `<div class="stat"><b>Summoner:</b> ${name}</div>`;
    htmlOut += `<div class="stat"><b>Level:</b> ${level}</div>`;
    htmlOut += `<div class="stat"><b>Rank:</b> ${rankTier}</div>`;
    if (lp) htmlOut += `<div class="stat"><b>LP:</b> ${lp}</div>`;
    htmlOut += `<div class="stat"><b>Wins:</b> ${wins}</div>`;
    htmlOut += `<div class="stat"><b>Losses:</b> ${losses}</div>`;
    if (ratio) htmlOut += `<div class="stat"><b>Win Rate:</b> ${ratio}</div>`;
    if (champs.length > 0) htmlOut += `<div class="stat"><b>Top Champs:</b> ${champs.join(", ")}</div>`;

    card.innerHTML = htmlOut;
    status.textContent = "";
    status.className = "";

  } catch(err) {
    console.error(err);
    card.innerHTML = "";
    status.textContent = "Error: " + err.message;
    status.className = "error";
  }
}
</script>
</body>
</html>
