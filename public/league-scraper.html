<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>League of Legends MetaDock ‚Äì Summoner Setup</title>
<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at center, #0a0a0a, #000);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.selector-wrapper {
  border: 3px solid #00ffff;
  border-radius: 12px;
  background: rgba(10,10,10,0.9);
  box-shadow: 0 0 30px rgba(0,255,255,0.4);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px;
  width: 380px;
}
.selector-header {
  font-size: 22px;
  font-weight: bold;
  color: #00ffff;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 20px;
  text-shadow: 0 0 10px #00ffff;
}
.search-row {
  display: flex;
  gap: 10px;
  width: 100%;
  justify-content: center;
  margin-bottom: 20px;
}
.search-row input {
  flex: 1;
  background: #111;
  border: 1px solid #00ffff;
  border-radius: 6px;
  color: #fff;
  padding: 8px 12px;
  font-size: 14px;
}
.search-row button {
  background: #00ffff;
  color: #000;
  border: none;
  border-radius: 6px;
  padding: 8px 14px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
.search-row button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 10px #00ffff;
}
.search-row button:disabled {
  background: #333;
  color: #777;
  cursor: not-allowed;
}
.profile-display {
  width: 200px;
  height: 200px;
  border: 2px solid #00ffff;
  border-radius: 12px;
  background: #111 url("./METAMEDIA/lol.jpeg") center/cover no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-bottom: 12px;
}
.profile-display img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.summoner-name {
  font-size: 18px;
  margin-top: 10px;
  text-shadow: 0 0 8px #00ffff;
}
.summoner-level {
  font-size: 13px;
  color: #aaa;
  margin-top: 4px;
}
.rank-display {
  margin-top: 10px;
  font-size: 14px;
  color: #00ffff;
  text-shadow: 0 0 8px rgba(0,255,255,0.7);
}
.action-row {
  margin-top: 20px;
  display: flex;
  gap: 12px;
}
.action-row button {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
.save-btn { background: #00ffff; color: #000; }
.home-btn { background: #111; border: 1px solid #00ffff; color: #00ffff; }
.save-btn:hover, .home-btn:hover { transform: scale(1.05); }

/* ‚úÖ Mini-card for real scrappable data only */
.mini-card {
  margin-top: 18px;
  width: 100%;
  border: 2px solid #00ffff;
  border-radius: 10px;
  padding: 12px;
  background: rgba(15,15,15,0.9);
  display: none;
  flex-direction: column;
  gap: 6px;
  text-align: left;
  box-shadow: 0 0 15px rgba(0,255,255,0.2);
}
.mini-card h4 {
  text-align: center;
  margin: 0 0 8px 0;
  font-size: 15px;
  color: #00ffff;
  text-shadow: 0 0 8px #00ffff;
}
.mini-stat {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  color: #bfffe8;
}
.mini-stat b { color: #00ffff; }

.status {
  margin-top: 16px;
  font-size: 14px;
  text-align: center;
}
.loading { color: #ffd24d; }
.error { color: #ff6b6b; }
.success { color: #00ff99; }
</style>
</head>
<body>

<div class="selector-wrapper">
  <div class="selector-header">Summoner Setup</div>

  <div class="search-row">
    <input id="summoner" placeholder="Enter Summoner Name..." onkeypress="if(event.key==='Enter')runScrape()" disabled>
    <button id="searchBtn" onclick="runScrape()" disabled>Search</button>
  </div>

  <div class="profile-display">
    <img id="profile-icon" src="./METAMEDIA/lol.jpeg" alt="Profile Icon">
  </div>

  <div class="summoner-name" id="player-name">No Profile Loaded</div>
  <div class="summoner-level" id="player-level"></div>
  <div class="rank-display" id="player-rank"></div>

  <div class="action-row">
    <button class="save-btn" id="save-profile">Save Profile</button>
    <button class="home-btn" id="goto-home">Enter Home Room</button>
  </div>

  <!-- ‚úÖ Only the real scrappable stats -->
  <div class="mini-card" id="mini-card">
    <h4>Summoner Stats</h4>
    <div class="mini-stat"><b>Level:</b> <span id="mini-level">‚Äî</span></div>
    <div class="mini-stat"><b>Rank:</b> <span id="mini-rank">‚Äî</span></div>
    <div class="mini-stat"><b>LP:</b> <span id="mini-lp">‚Äî</span></div>
    <div class="mini-stat"><b>Wins:</b> <span id="mini-wins">‚Äî</span></div>
    <div class="mini-stat"><b>Losses:</b> <span id="mini-losses">‚Äî</span></div>
  </div>

  <div class="status" id="status"></div>
</div>

<script>
<script>
window.addEventListener("DOMContentLoaded", checkRegionStatus);

async function checkRegionStatus() {
  const statusDiv = document.getElementById("status");
  const input = document.getElementById("summoner");
  const btn = document.getElementById("searchBtn");
  statusDiv.textContent = "Checking online status...";
  statusDiv.className = "status loading";
  try {
    const res = await fetch("/.netlify/functions/checkStatus");
    if (!res.ok) throw new Error("Unable to reach status endpoint");
    const data = await res.json();
    if (data.allOnline) {
      statusDiv.textContent = "‚úÖ All regions online.";
      statusDiv.className = "status success";
      input.disabled = false;
      btn.disabled = false;
    } else {
      statusDiv.textContent = `‚ö†Ô∏è Offline: ${data.offlineRegions.join(", ")}`;
      statusDiv.className = "status error";
    }
  } catch (err) {
    statusDiv.textContent = "‚ö†Ô∏è Could not reach Riot servers.";
    statusDiv.className = "status error";
  }
}

async function fetchProfile(name) {
  const url = `https://www.leagueofgraphs.com/summoner/na/${encodeURIComponent(name)}`;
  const proxied = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
  const res = await fetch(proxied);
  if (!res.ok) throw new Error("Failed to load player page");
  const html = await res.text();
  if (!html.includes("<html")) throw new Error("Invalid HTML response");
  return html;
}

async function runScrape() {
  const name = document.getElementById("summoner").value.trim();
  const status = document.getElementById("status");
  const miniCard = document.getElementById("mini-card");
  const confirmBtn = document.getElementById("save-profile");
  const homeBtn = document.getElementById("goto-home");

  homeBtn.disabled = true;
  if (!name) {
    status.textContent = "Enter a summoner name first.";
    status.className = "status error";
    return;
  }

  status.textContent = "Fetching data...";
  status.className = "status loading";
  try {
    const html = await fetchProfile(name);
    const doc = new DOMParser().parseFromString(html, "text/html");

    const level = doc.querySelector(".bannerSubtitle")?.textContent.replace("Level","").trim() || "Unknown";
    const rankTier = doc.querySelector(".leagueTier")?.textContent.trim() || "Unranked";
    const lp = doc.querySelector(".leaguePoints")?.textContent.trim() || "0 LP";
    const wins = doc.querySelector(".wins")?.textContent.replace("Wins:","").trim() || "0";
    const losses = doc.querySelector(".losses")?.textContent.replace("Losses:","").trim() || "0";

    document.getElementById("player-name").textContent = name;
    document.getElementById("player-level").textContent = `Level ${level}`;
    document.getElementById("player-rank").textContent = rankTier;

    document.getElementById("mini-level").textContent = level;
    document.getElementById("mini-rank").textContent = rankTier;
    document.getElementById("mini-lp").textContent = lp;
    document.getElementById("mini-wins").textContent = wins;
    document.getElementById("mini-losses").textContent = losses;
    miniCard.style.display = "flex";

    // ‚úÖ Auto-save right here
    localStorage.setItem("summonerData", JSON.stringify({ name, level, rank: rankTier, lp, wins, losses }));

    // üîπ Change button to "Confirm" mode
    confirmBtn.textContent = "Confirm Profile";
    confirmBtn.disabled = false;
    confirmBtn.style.background = "#ffd24d";
    confirmBtn.style.color = "#000";

    // lock home until confirmed
    homeBtn.disabled = true;
    homeBtn.style.opacity = "0.5";

    status.textContent = "‚úÖ Profile loaded. Please confirm to continue.";
    status.className = "status success";
  } catch (err) {
    status.textContent = "Error: " + err.message;
    status.className = "status error";
  }
}

// üîπ Confirm button
document.getElementById("save-profile").addEventListener("click", () => {
  const status = document.getElementById("status");
  const homeBtn = document.getElementById("goto-home");

  status.textContent = "‚úÖ Profile confirmed. You may enter the Home Room.";
  status.className = "status success";
  homeBtn.disabled = false;
  homeBtn.style.opacity = "1";
  homeBtn.style.cursor = "pointer";
  const confirmBtn = document.getElementById("save-profile");
  confirmBtn.textContent = "Confirmed";
  confirmBtn.style.background = "#00ff99";
  confirmBtn.disabled = true;
});

// üîπ Go to Home Room
document.getElementById("goto-home").addEventListener("click", () => {
  if (document.getElementById("goto-home").disabled) return;
  window.location.href = "homeroom.html";
});
</script>
</body>
</html>
