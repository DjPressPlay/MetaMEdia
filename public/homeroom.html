<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Home Room ‚Äî Framed</title>
<style>
  * { box-sizing:border-box; margin:0; padding:0; }

  body {
    height:100vh; width:100vw; overflow:hidden;
    background:radial-gradient(circle at center,#222 0%,#000 100%);
    display:flex; 
    flex-direction: column;
    justify-content:center; 
    align-items:center;
    font-family:"Segoe UI",sans-serif;
    gap: 20px;
  }
.frame {
  position: relative;
  width: 90vw;
  max-width: 1400px;
  height: 80vh;
  max-height: 800px;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 8px solid #00ffff;
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(0,255,255,0.5), inset 0 0 20px rgba(0,255,255,0.2);
  background: #000;
  cursor: none;
}

.sparkle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  box-shadow: 0 0 4px white, 0 0 8px rgba(255,255,255,0.8);
  animation: sparklefall 0.8s ease-out forwards;
}

.character-sparkle {
  position: absolute;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 15;
  animation: characterSparklefall 1.2s ease-out forwards;
}

.character-sparkle.blue {
  background: rgba(100, 150, 255, 0.95);
  box-shadow: 0 0 10px rgba(100, 150, 255, 1), 0 0 20px rgba(100, 150, 255, 0.8), 0 0 30px rgba(100, 180, 255, 0.6);
}

.character-sparkle.purple {
  background: rgba(180, 100, 255, 0.95);
  box-shadow: 0 0 10px rgba(180, 100, 255, 1), 0 0 20px rgba(180, 100, 255, 0.8), 0 0 30px rgba(200, 120, 255, 0.6);
}

.character-sparkle.black {
  background: rgba(30, 30, 30, 0.95);
  border: 2px solid rgba(255, 255, 255, 0.6);
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(200, 200, 200, 0.6), 0 0 30px rgba(150, 150, 150, 0.4);
}

.character-sparkle.pink {
  background: rgba(255, 100, 200, 0.95);
  box-shadow: 0 0 10px rgba(255, 100, 200, 1), 0 0 20px rgba(255, 100, 200, 0.8), 0 0 30px rgba(255, 150, 220, 0.6);
}

@keyframes characterSparklefall {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(40px) scale(0.1);
  }
}

@keyframes sparklefall {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(30px) scale(0.2);
  }
}


  .room {
    position:relative;
    width:100%; height:100%;
    background: url('https://ik.imagekit.io/q2zhbhqmf/arcane-league-of-.jpg?updatedAt=1762676313439') center/cover no-repeat;
    cursor:default;
    overflow:hidden;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .room::before {
    content: '';
    position: absolute;
    inset: 0;
    backdrop-filter: blur(0.3px) brightness(1.05);
    background: 
      linear-gradient(135deg, 
        rgba(255,255,255,0.15) 0%, 
        rgba(255,255,255,0.05) 20%, 
        transparent 40%, 
        transparent 60%,
        rgba(255,255,255,0.03) 80%,
        transparent 100%
      ),
      linear-gradient(45deg,
        transparent 0%,
        rgba(255,255,255,0.08) 45%,
        rgba(255,255,255,0.12) 50%,
        rgba(255,255,255,0.08) 55%,
        transparent 100%
      );
    pointer-events: none;
    z-index: 1;
  }

  .room::after {
    content: '';
    position: absolute;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.6) 20%, transparent 70%);
    top: 15%;
    left: 70%;
    filter: blur(20px);
    opacity: 0;
    pointer-events: none;
    z-index: 2;
    animation: lensFlare 8s ease-in-out infinite;
  }

  @keyframes lensFlare {
    0%, 90%, 100% {
      opacity: 0;
      transform: scale(0.5);
    }
    92%, 98% {
      opacity: 0.7;
      transform: scale(1.2);
    }
    95% {
      opacity: 1;
      transform: scale(1.5);
    }
  }

  .ground {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 15%;
    background: #000;
    border-top: 3px solid #00ffff;
    z-index: 10;
  }

  .platform-spots {
    position: absolute;
    bottom: 15%;
    left: 0;
    width: 100%;
    height: 3px;
    display: flex;
    justify-content: space-evenly;
    align-items: flex-end;
  }

  .spot-marker {
    position: absolute;
    width: 80px;
    height: 3px;
    background: rgba(0,255,255,0.3);
    bottom: 15%;
  }

  .spot-marker:nth-child(1) { left: 20%; }
  .spot-marker:nth-child(2) { left: 50%; transform: translateX(-50%); }
  .spot-marker:nth-child(3) { left: 80%; }

  .character-container {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 480px;
    height: 480px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    pointer-events: none;
    transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 20;
    overflow: visible;
  }

  .character {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .character img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center bottom;
    transition: transform 0.3s ease;
  }

  .character-container.moving .character img {
    animation: characterHover 0.4s ease-in-out;
  }

  @keyframes characterHover {
    0%, 100% {
      transform: translateY(0px);
    }
    25% {
      transform: translateY(-10px);
    }
    50% {
      transform: translateY(-5px);
    }
    75% {
      transform: translateY(-12px);
    }
  }

  .character img.fallback-orb {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 
      0 0 40px rgba(0, 255, 255, 0.8),
      0 0 80px rgba(0, 255, 255, 0.6),
      inset 0 0 30px rgba(0, 255, 255, 0.4);
    border: 3px solid rgba(0, 255, 255, 0.9);
    background: radial-gradient(circle, rgba(0, 255, 255, 0.2) 0%, rgba(0, 0, 0, 0.8) 100%);
    animation: orbGlow 3s ease-in-out infinite, orbFloat 4s ease-in-out infinite;
    position: relative;
    z-index: 30;
  }

  @keyframes orbGlow {
    0%, 100% {
      box-shadow: 
        0 0 40px rgba(0, 255, 255, 0.8),
        0 0 80px rgba(0, 255, 255, 0.6),
        inset 0 0 30px rgba(0, 255, 255, 0.4);
    }
    50% {
      box-shadow: 
        0 0 60px rgba(0, 255, 255, 1),
        0 0 120px rgba(0, 255, 255, 0.8),
        inset 0 0 50px rgba(0, 255, 255, 0.6);
    }
  }

  @keyframes orbFloat {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  .character::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: inherit;
    background-size: contain;
    background-position: center bottom;
    background-repeat: no-repeat;
    opacity: 0.25;
    filter: blur(2px) brightness(1.1);
    pointer-events: none;
    transform: scaleY(-1);
    mask-image: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.4) 30%, transparent 60%);
    -webkit-mask-image: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.4) 30%, transparent 60%);
    z-index: -1;
  }






  .depth-dot {
    display:none;
  }
  
  
  :root {
  --accent: #00ffff;
}

/* ===================================== */
/* ü©µ Nameplate with matching cyan glow  */
/* ===================================== */
.nameplate {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 320px;
  max-width: 380px;
  background: rgba(20, 20, 20, 0.85);
  border: 2px solid var(--accent);
  border-radius: 12px;
  padding: 14px 18px;
  color: #fff;
  box-shadow:
    inset 0 0 15px rgba(0, 255, 255, 0.25),
    0 0 25px rgba(0, 255, 255, 0.6),
    0 0 60px rgba(0, 180, 255, 0.35),
    0 4px 25px rgba(0, 0, 0, 0.6);
  animation: plateGlow 4s ease-in-out infinite;
  z-index: 5;
  overflow: hidden;
}

@keyframes plateGlow {
  0%, 100% {
    box-shadow:
      inset 0 0 15px rgba(0, 255, 255, 0.25),
      0 0 25px rgba(0, 255, 255, 0.6),
      0 0 60px rgba(0, 180, 255, 0.35),
      0 4px 25px rgba(0, 0, 0, 0.6);
  }
  50% {
    box-shadow:
      inset 0 0 30px rgba(0, 255, 255, 0.35),
      0 0 45px rgba(0, 255, 255, 0.8),
      0 0 90px rgba(0, 200, 255, 0.5),
      0 4px 25px rgba(0, 0, 0, 0.6);
  }
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  padding-bottom: 6px;
  margin-bottom: 10px;
}

.name-text {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-shadow:
    0 0 6px rgba(0,255,255,0.9),
    0 0 12px rgba(0,200,255,0.4);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 300px;
}

.rank-badge {
  width: 36px;
  height: 36px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border: 2px solid var(--accent);
  border-radius: 50%;
  box-shadow:
    0 0 10px rgba(0,255,255,0.8),
    inset 0 0 8px rgba(0,255,255,0.4);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  text-align: center;
}

.quest-progress-bar {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(255,255,255,0.15);
}

.quest-progress-label {
  font-size: 10px;
  text-transform: uppercase;
  color: #aaa;
  letter-spacing: 0.5px;
  margin-bottom: 6px;
  text-align: center;
}

.quest-progress-container {
  width: 100%;
  height: 16px;
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 8px;
  overflow: hidden;
  position: relative;
}

.quest-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, rgba(0, 255, 255, 0.6), rgba(0, 200, 255, 0.8));
  border-radius: 8px;
  transition: width 0.5s ease;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

.quest-progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 10px;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 0 3px #000, 0 0 6px rgba(0, 255, 255, 0.8);
  pointer-events: none;
}

.stat-value {
  color: var(--accent);
  font-weight: 700;
  font-size: 14px;
  text-shadow: 0 0 8px rgba(0,255,255,0.6);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.stat-label {
  font-size: 9px;
  text-transform: uppercase;
  color: #aaa;
  letter-spacing: 0.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ============================= */
/* üèÜ Rank Display Top Right */
/* ============================= */
.rank-display {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: rgba(20, 20, 20, 0.85);
  border: 2px solid var(--accent);
  border-radius: 12px;
  padding: 14px 18px;
  box-shadow:
    inset 0 0 15px rgba(0, 255, 255, 0.25),
    0 0 25px rgba(0, 255, 255, 0.6),
    0 0 60px rgba(0, 180, 255, 0.35),
    0 4px 25px rgba(0, 0, 0, 0.6);
  animation: plateGlow 4s ease-in-out infinite;
  z-index: 5;
}

/* ============================= */
/* üìã Dropdown Tabs Container */
/* ============================= */
.tabs-container {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  z-index: 5;
}

.tab-item {
  background: rgba(20, 20, 20, 0.85);
  border: 2px solid var(--accent);
  border-radius: 12px;
  box-shadow:
    inset 0 0 15px rgba(0, 255, 255, 0.25),
    0 0 25px rgba(0, 255, 255, 0.6),
    0 0 60px rgba(0, 180, 255, 0.35),
    0 4px 25px rgba(0, 0, 0, 0.6);
  animation: plateGlow 4s ease-in-out infinite;
  overflow: hidden;
  min-width: 180px;
}

.tab-header {
  width: 100%;
  background: transparent;
  border: none;
  color: var(--accent);
  padding: 12px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Segoe UI', sans-serif;
  position: relative;
}

.quest-notification {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 24px;
  height: 24px;
  background: #ff6b6b;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 16px;
  font-weight: bold;
  animation: questFlash 1s infinite;
  box-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
}

@keyframes questFlash {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.6;
    transform: scale(1.1);
  }
}

.tab-header:hover {
  background: rgba(0, 255, 255, 0.1);
}

.tab-title {
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-shadow:
    0 0 6px rgba(0, 255, 255, 0.9),
    0 0 12px rgba(0, 200, 255, 0.4);
}

.tab-icon {
  font-size: 12px;
  transition: transform 0.3s ease;
}

.tab-item.active .tab-icon {
  transform: rotate(180deg);
}

.tab-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
  background: rgba(0, 0, 0, 0.5);
}

.tab-item.active .tab-content {
  max-height: 400px;
  border-top: 1px solid rgba(0, 255, 255, 0.3);
}

.tab-content-inner {
  padding: 15px;
  color: #fff;
  font-size: 13px;
  overflow-y: auto;
  max-height: 370px;
}

.tab-content-inner p {
  margin: 0;
  color: rgba(255, 255, 255, 0.8);
  text-align: center;
}

/* Champion Progress Items */
.champion-progress-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid rgba(0, 255, 255, 0.2);
  border-radius: 8px;
  margin-bottom: 8px;
  transition: all 0.3s ease;
}

.champion-progress-item:hover {
  background: rgba(0, 255, 255, 0.1);
  border-color: rgba(0, 255, 255, 0.4);
}

.champion-progress-icon {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  overflow: hidden;
  flex-shrink: 0;
  border: 2px solid rgba(0, 255, 255, 0.4);
}

.champion-progress-icon img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.champion-progress-details {
  flex: 1;
  min-width: 0;
}

.champion-progress-name {
  font-size: 12px;
  font-weight: 700;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 4px;
  text-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
}

.champion-progress-bar-container {
  width: 100%;
  height: 12px;
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(0, 255, 255, 0.3);
  border-radius: 6px;
  overflow: hidden;
  position: relative;
}

.champion-progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, rgba(0, 255, 255, 0.6), rgba(0, 200, 255, 0.8));
  border-radius: 6px;
  transition: width 0.5s ease;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
}

.champion-progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 9px;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 0 3px #000, 0 0 6px rgba(0, 255, 255, 0.8);
  pointer-events: none;
}

/* Lore Items */
.lore-item {
  padding: 10px;
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid rgba(0, 255, 255, 0.2);
  border-radius: 8px;
  margin-bottom: 8px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.quest-item {
  padding: 12px;
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid rgba(0, 255, 255, 0.2);
  border-radius: 8px;
  margin-bottom: 8px;
  transition: all 0.3s ease;
}

.quest-item.completed {
  background: rgba(0, 255, 0, 0.1);
  border-color: rgba(0, 255, 0, 0.4);
}

.quest-item-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 6px;
  text-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
}

.quest-item.completed .quest-item-title {
  color: #0f0;
}

.quest-item-description {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.4;
}

.lore-item:hover {
  background: rgba(0, 255, 255, 0.1);
  border-color: rgba(0, 255, 255, 0.4);
  transform: translateX(2px);
}

.lore-item-title {
  font-size: 11px;
  font-weight: 700;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 4px;
  text-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
}

.lore-item-preview {
  font-size: 10px;
  color: rgba(255, 255, 255, 0.7);
  line-height: 1.3;
}

.lore-item.collected {
  background: rgba(0, 255, 255, 0.15);
  border-color: rgba(0, 255, 255, 0.6);
}

.lore-item.collected .lore-item-title::before {
  content: '‚úì ';
  color: #0f0;
}

.tutorial-info-box {
  position: relative;
  width: 90vw;
  max-width: 1400px;
  height: 100px;
  background: rgba(20, 20, 20, 0.95);
  border: 8px solid #00ffff;
  border-radius: 12px;
  color: #fff;
  box-shadow:
    0 0 30px rgba(0,255,255,0.5), 
    inset 0 0 20px rgba(0,255,255,0.2);
  z-index: 1000;
  display: none;
  overflow: hidden;
  transition: opacity 0.3s ease;
}

.tutorial-info-box.active {
  display: block;
  animation: slideInFromBottom 0.5s ease, flashBorder 2s ease-in-out infinite;
}

@keyframes slideInFromBottom {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes flashBorder {
  0%, 100% {
    border-color: #00ffff;
    box-shadow:
      0 0 30px rgba(0,255,255,0.5), 
      inset 0 0 20px rgba(0,255,255,0.2);
  }
  50% {
    border-color: rgba(0, 255, 255, 0.7);
    box-shadow:
      0 0 40px rgba(0,255,255,0.7), 
      inset 0 0 30px rgba(0,255,255,0.3);
  }
}

.tutorial-info-box-header {
  display: none;
}

.tutorial-info-box-title {
  display: none;
}

.tutorial-info-box-close {
  position: absolute;
  top: 4px;
  right: 8px;
  background: none;
  border: none;
  color: var(--accent);
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease;
  z-index: 10;
}

.tutorial-info-box-close:hover {
  transform: scale(1.2);
  color: #fff;
}

.tutorial-info-box-content {
  width: 100%;
  height: 100%;
  padding: 10px 40px 10px 20px;
  overflow: hidden;
  position: relative;
}

.tutorial-scroll-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  animation: scrollVertical 8s ease-in-out;
  animation-fill-mode: forwards;
}

@keyframes scrollVertical {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
}

.tutorial-scroll-container.scrolling {
  animation: scrollVertical 8s ease-in-out;
}

.tutorial-message {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: rgba(0, 255, 255, 0.1);
  border-radius: 6px;
  border-left: 3px solid var(--accent);
  font-size: 14px;
  line-height: 1.5;
  color: rgba(255, 255, 255, 0.9);
  white-space: normal;
  min-height: 50px;
}

.tutorial-info-box-content p {
  margin: 0;
}

.tutorial-info-box-content p:last-child {
  margin-bottom: 0;
}

.tutorial-info-box-step {
  display: inline-block;
  padding: 4px 8px;
  background: rgba(0, 255, 255, 0.15);
  border-radius: 4px;
  margin: 0 4px;
}

.tutorial-info-box-highlight {
  color: var(--accent);
  font-weight: 700;
  text-shadow: 0 0 4px rgba(0, 255, 255, 0.6);
}

.rank-badge-large {
  width: 80px;
  height: 80px;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  border: 3px solid var(--accent);
  border-radius: 50%;
  box-shadow:
    0 0 15px rgba(0,255,255,0.8),
    inset 0 0 12px rgba(0,255,255,0.4);
  margin-bottom: 8px;
}

.rank-text {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--accent);
  text-shadow:
    0 0 6px rgba(0,255,255,0.9),
    0 0 12px rgba(0,200,255,0.4);
}

.level-container {
  margin-top: 12px;
  padding: 8px 16px;
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid var(--accent);
  border-radius: 8px;
  text-align: center;
  box-shadow:
    0 0 10px rgba(0,255,255,0.4),
    inset 0 0 8px rgba(0,255,255,0.2);
}

.level-label {
  font-size: 10px;
  text-transform: uppercase;
  color: #aaa;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.level-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--accent);
  text-shadow: 0 0 8px rgba(0,255,255,0.6);
}

/* ============================= */
/* üîπ Hotspots (All Enhanced) */
/* ============================= */
/* ‚úÖ Visible white border around hotspots + label borders */
.hotspot {
  position: absolute;
  width: 2.2%;
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(0, 255, 255, 0.4) 0%, rgba(0, 136, 255, 0.3) 60%, transparent 100%);
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.5), 0 0 24px rgba(0, 255, 255, 0.3);
  border: 2px solid rgba(255, 255, 255, 0.4);
  cursor: none;
  animation: pulse 2s infinite ease-in-out;
  z-index: 25;
  transition: transform 0.2s ease, box-shadow 0.3s ease, border-color 0.3s ease;
}

/* ‚ú¥Ô∏è Hover Glow */
.hotspot:hover {
  transform: scale(1.3);
  cursor: pointer;
  box-shadow:
    0 0 18px #00ffff,
    0 0 36px #00ffff,
    0 0 60px rgba(0, 255, 255, 0.5);
  border-color: #ffffff;
}

.hotspot:hover::after {
  opacity: 1;
}

/* üè∑Ô∏è Floating label ‚Äî with bold white border directly around the word */
.hotspot::before {
  content: attr(data-label);
  position: absolute;
  bottom: 155%;
  left: 50%;
  transform: translateX(-50%) scale(0.9);
  background: rgba(0, 0, 0, 0.65);
  border: 3px solid #ffffff;             /* ‚¨ÖÔ∏è strong white border */
  color: #00ffff;
  padding: 8px 18px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 900;
  letter-spacing: 2px;
  text-transform: uppercase;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
  white-space: nowrap;
  text-shadow:
    0 0 10px rgba(0,255,255,0.9),
    0 0 20px rgba(0,255,255,0.6);
  box-shadow:
    0 0 25px rgba(0,255,255,0.8),
    inset 0 0 10px rgba(255,255,255,0.3);
  z-index: 30;
}

/* ‚ú¥Ô∏è Label shows on hover or when character is close */
.hotspot:hover::before,
.hotspot.active::before {
  opacity: 1;
  transform: translateX(-50%) scale(1.1);
  background: rgba(0, 0, 0, 0.85);
  border-color: #ffffff;                /* keep border bright white */
}

/* Label shows on hover or when active */
.hotspot:hover::before,
.hotspot.active::before {
  opacity: 1;
  transform: translateX(-50%) scale(1.1);
}

/* Placement */
#spot1 { left: 20%; bottom: 20%; }
#spot2 { left: 50%; bottom: 20%; }
#spot3 { left: 80%; bottom: 20%; }

/* Breathing motion */
@keyframes pulse {
  0%, 100% { transform: translateY(-50%) scale(1); opacity: 0.5; }
  50%      { transform: translateY(-50%) scale(1.15); opacity: 0.7; }
}

/* ============================= */
/* üîπ Overlay Screens */
/* ============================= */
.overlay-screen {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  border: 2px solid #00ffff;
  box-shadow: 0 0 40px rgba(0,255,255,0.4);
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 999;
}

.overlay-screen.active {
  opacity: 1;
  pointer-events: all;
}
#screen1 {
  background: url("https://www.freeiconspng.com/uploads/computer-monitor-blank-png--19.png") center/cover no-repeat; center/cover no-repeat;
}
#screen1 {
  width: 70%;
  height: 70%;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border-radius: 16px;
  overflow: hidden;
}
#screen1::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.65);
}

.overlay-screen h2 {
  margin-bottom: 10px;
  font-size: 24px;
  color: #00ffff;
}

.overlay-screen p {
  max-width: 80%;
  text-align: center;
  opacity: 0.9;
}

.close-btn {
  position: absolute;
  top: 16px;
  right: 20px;
  font-size: 28px;
  background: none;
  border: none;
  color: #00ffff;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.close-btn:hover {
  transform: scale(1.2);
}

  
/* ‚ú® Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}



.closet-container {
  width: 90%;
  max-width: 900px;
  margin: 0 auto;
  padding: 30px;
}

.closet-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 20px;
  justify-items: center;
  align-items: center;
  max-height: 60vh;
  overflow-y: auto;
  padding: 20px;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 12px;
  border: 1px solid rgba(0, 255, 255, 0.3);
}

.champion-card {
  position: relative;
  width: 100px;
  height: 100px;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: 2px solid rgba(0, 255, 255, 0.4);
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

.champion-card:hover {
  transform: scale(1.15);
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.8);
  border-color: #00ffff;
}

.champion-card.selected {
  border: 3px solid #ffffff;
  box-shadow: 0 0 30px rgba(255, 255, 255, 0.9), 0 0 50px rgba(0, 255, 255, 1);
  transform: scale(1.1);
}

.champion-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.champion-card::after {
  content: attr(data-name);
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.85);
  color: #00ffff;
  padding: 4px;
  font-size: 11px;
  text-align: center;
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 0.5px;
}

/* üè∑Ô∏è Floating label for proximity detection */
.hotspot::before {
 
}

/* Show label when hotspot is near character */
.hotspot.near::before {
  opacity: 1;
  transform: translateX(-50%) scale(1.1);
}

/* Enhanced hover effect still works */
.hotspot:hover::before {
  opacity: 1;
  transform: translateX(-50%) scale(1.1);
}

/* ============================= */
/* üíª Mini PC Screen ‚Äî Metallic Beveled Frame */
/* ============================= */
.mini-pc-screen {
  position: absolute;
  width: 80%;
  aspect-ratio: 16 / 9;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background:
    linear-gradient(180deg, rgba(0, 0, 0, 0.9) 0%, rgba(10, 10, 10, 1) 100%),
    url("https://images.unsplash.com/photo-1527443154391-507e9dc6c5cc?auto=format&fit=crop&w=1400&q=80") center/cover no-repeat;
  border-radius: 14px;
  overflow: hidden;
  z-index: 1000;

  /* ü©∂ Metallic gradient frame with bevel + glow */
  border: 10px solid transparent;
  background-clip: padding-box, border-box;
  background-origin: border-box;
  background-image:
    linear-gradient(180deg, rgba(0, 0, 0, 0.9), rgba(10, 10, 10, 1)),
    linear-gradient(145deg, #d7d7d7, #ffffff, #b8b8b8, #8a8a8a);
  box-shadow:
    inset 0 0 15px rgba(255, 255, 255, 0.1),
    0 0 30px rgba(0, 255, 255, 0.35),
    0 0 60px rgba(0, 180, 255, 0.25);
}


/* üñ•Ô∏è Desktop Area (inside mini screen) */
.desktop {
  width: 100%;
  height: 100%;
  display: flex;
  flex-wrap: wrap;
  align-content: flex-start;
  justify-content: flex-start;
  padding: 30px;
  background: radial-gradient(circle at bottom right, rgba(0,255,255,0.08) 0%, transparent 80%);
  position: relative;
  z-index: 3;
}

/* üß≠ App Icons */
.app-icon {
  width: 72px;
  height: 72px;
  margin: 15px;
  border-radius: 12px;
  background: rgba(255,255,255,0.08);
  border: 2px solid rgba(255,255,255,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
  cursor: pointer;
}

.app-icon img {
  width: 65%;
  height: 65%;
  object-fit: contain;
  filter: drop-shadow(0 0 4px rgba(0,255,255,0.5));
  pointer-events: none;
}

.app-icon:hover {
  transform: scale(1.15);
  box-shadow: 0 0 20px rgba(0,255,255,0.6);
  border-color: #00ffff;
  background: rgba(0,255,255,0.15);
}

.app-icon:active {
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(0,255,255,0.4);
}

/* Label text */
.app-icon::before {
  content: attr(data-app);
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 10px;
  color: #00ffff;
  text-shadow: 0 0 6px rgba(0,255,255,0.8);
  letter-spacing: 0.5px;
  text-transform: uppercase;
  white-space: nowrap;
}


.app-icon:hover {
  transform: scale(1.15);
  box-shadow: 0 0 20px rgba(0,255,255,0.6);
  border-color: #00ffff;
  background: rgba(0,255,255,0.15);
}

/* ‚ú® Scanline Overlay */
.mini-pc-screen::after {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03) 0px,
    rgba(255,255,255,0.03) 1px,
    transparent 2px,
    transparent 4px
  );
  pointer-events: none;
  mix-blend-mode: overlay;
  opacity: 0.25;
  z-index: 4;
}
.mini-pc-screen {
  background:
    url("https://i.redd.it/9s2t54ycbtz71.jpg") center/cover no-repeat,
    linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(10,10,10,1) 100%);
}


.app-window {
  position: absolute;
  inset: 40px 40px 40px 40px; /* adds spacing within the mini-pc frame */
  width: auto;
  height: auto;
  background: rgba(20,20,20,0.95);
  border: 2px solid #00ffff;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,255,255,0.4);
  color: #fff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 10;
}


/* ============================= */
/* üîπ App Window pc close Button */
/* ============================= */
.app-header {
  position: relative;
  background: rgba(0, 255, 255, 0.1);
  border-bottom: 1px solid rgba(0, 255, 255, 0.3);
  padding: 6px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #00ffff;
  font-size: 13px;
}

.app-header {
  position: relative;
  z-index: 20; /* ‚¨ÖÔ∏è make header layer above everything else */
}

.close-app {
  position: absolute;
  top: 6px;
  right: 10px;
  background: none;
  border: none;
  color: #00ffff;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 21; /* ‚¨ÖÔ∏è ensure it floats above scanlines or gradients */
}

.close-app:hover {
  color: #ffffff;
  transform: scale(1.25);
  text-shadow: 0 0 6px #00ffff;
}


.close-pc {
  position: absolute;
  top: 12px;
  right: 16px;
  font-size: 28px;
  background: none;
  border: none;
  color: #00ffff;
  cursor: pointer;
  z-index: 10;
  transition: transform 0.2s ease, color 0.2s ease;
}

.close-pc:hover {
  transform: scale(1.25);
  color: #ffffff;
}

/* Optional: smooth hide animation */
.mini-pc-screen {
  opacity: 1;
  transition: opacity 0.4s ease;
}


  
</style>
</head>
<body>
<!--Gameframe---------------------------->
  <div class="frame">

    
<!-- üèÜ Rank Display Top Right -->
<div class="rank-display" id="rank-display">
  <div class="rank-badge-large" id="rank-badge-large"></div>
  <div class="rank-text" id="rank-text"></div>
  <div class="level-container">
    <div class="level-label">Level</div>
    <div class="level-value" id="summoner-level-display"></div>
  </div>
</div>

<!-- üìã Dropdown Tabs Container -->
<div class="tabs-container">
  <div class="tab-item" id="quest-tab-item">
    <button class="tab-header" data-tab="quests">
      <span class="tab-title">Quests</span>
      <span class="tab-icon">‚ñº</span>
      <span class="quest-notification" id="quest-notification" style="display: none;">!</span>
    </button>
    <div class="tab-content" id="tab-quests">
      <div class="tab-content-inner" id="quest-list">
        <p>Quest list will be populated here</p>
      </div>
    </div>
  </div>

  <div class="tab-item">
    <button class="tab-header" data-tab="champions">
      <span class="tab-title">Champion Progress</span>
      <span class="tab-icon">‚ñº</span>
    </button>
    <div class="tab-content" id="tab-champions">
      <div class="tab-content-inner">
        <p>Champion progress will be populated here</p>
      </div>
    </div>
  </div>

  <div class="tab-item">
    <button class="tab-header" data-tab="lore">
      <span class="tab-title">Lore Box</span>
      <span class="tab-icon">‚ñº</span>
    </button>
    <div class="tab-content" id="tab-lore">
      <div class="tab-content-inner">
        <p>Lore files will be populated here</p>
      </div>
    </div>
  </div>
</div>

<!-- ü©µ HUD Nameplate -->
<div class="nameplate" id="hud">
  <div class="header">
    <div class="name-text" id="summoner-name"></div>
    <div class="rank-badge" id="summoner-badge"></div>
  </div>

  <div class="stats-grid">
    <div><div class="stat-value" id="summoner-lp"></div><div class="stat-label">LP</div></div>
    <div><div class="stat-value" id="summoner-wins"></div><div class="stat-label">Wins</div></div>
    <div><div class="stat-value" id="summoner-losses"></div><div class="stat-label">Losses</div></div>
  </div>
  
  <div class="quest-progress-bar">
    <div class="quest-progress-label" id="quest-progress-label">Quest Level 1</div>
    <div class="quest-progress-container">
      <div class="quest-progress-fill" id="quest-progress-fill" style="width: 0%"></div>
      <div class="quest-progress-text" id="quest-progress-text">0/9</div>
    </div>
  </div>
</div>


    
<!-- üîπ Frame inside ---------->
    <div class="room">
      <div class="ground"></div>
      
      <div class="spot-marker"></div>
      <div class="spot-marker"></div>
      <div class="spot-marker"></div>
      
     <div class="character-container">
        <div class="character">
          <img id="character-img" src="" alt="Character">
        </div>
      </div>
      
<!-- üîπ Hotspot placement -->
<div class="hotspot" id="spot1" data-label="PC"></div>
<div class="hotspot" id="spot2" data-label="STYLE"></div>
<div class="hotspot" id="spot3" data-label="PHONE"></div>
      </div>
    </div>
  </div>
  
  
<!-- üîπ Overlay Screens  ------------------------>
<div class="overlay-screen" id="screen1">
  <button class="close-btn">√ó</button>

  <div class="mini-pc-screen">
    <div class="desktop">
      <div class="app-icon" data-app="lolid">
        <img src="METAMEDIA/League-of-Legends-Logo-2008.png" alt="LoL ID Archive">
      </div>

      <div class="app-icon" data-app="notes">
        <img src="https://cdn-icons-png.flaticon.com/512/2965/2965358.png" alt="Notes">
      </div>

      <div class="app-icon" data-app="signalz">
        <img src="https://cdn-icons-png.flaticon.com/512/5968/5968778.png" alt="Signalz">
      </div>
    </div>

    <!-- üß© Mini Apps ------------------------>
  <div class="app-icon" data-app="league">
  <img src="https://upload.wikimedia.org/wikipedia/en/7/77/League_of_Legends_logo.png" alt="League">
</div>

  <!-- üîπ App 2 ------------------>
    <div class="mini-app-window" id="app-notes" style="display: none;">
      <h2>Notes App</h2>
      <textarea placeholder="Type your notes here..."></textarea>
    </div>
 
       
  <!-- üîπ App 3------------------>
    <div class="mini-app-window" id="app-signalz" style="display: none;">
      <h2>SignalZ Hub</h2>
      <p>Future integration point for live SignalZ feed.</p>
    </div>
  </div>
</div>

<!-- üîπ SEPARATE Champion Closet Overlay (screen2) -->
<div class="overlay-screen" id="screen2">
  <button class="close-btn">√ó</button>
  <div class="closet-container">
    <h2 style="color: #00ffff; margin-bottom: 20px;">Champion Closet</h2>
    <div id="closet-champions" class="closet-grid">
      <p style="color: #aaa;">Loading champions from your recent match...</p>
    </div>
  </div>
</div>   
    
    
<div class="overlay-screen" id="screen3">
  <button class="close-btn">√ó</button>
  <h2>Screen Three</h2>
  <p>This is the third in-game screen.</p>
</div>

<div class="tutorial-info-box" id="tutorial-info-box">
  <button class="tutorial-info-box-close" id="tutorial-close">√ó</button>
  <div class="tutorial-info-box-content" id="tutorial-content">
    <div class="tutorial-scroll-container" id="tutorial-scroll">
      <div class="tutorial-message">Welcome! Complete quests to unlock lore and progress.</div>
      <div class="tutorial-message">Welcome! Complete quests to unlock lore and progress.</div>
    </div>
  </div>
</div>

 <!-- ‚úÖ Game Controller ------------------------------------------------------------------------>
<script type="module" src="src/gameController.js"></script>
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    
    // Tab functionality
    const tabHeaders = document.querySelectorAll('.tab-header');
    
    tabHeaders.forEach(header => {
      header.addEventListener('click', (e) => {
        const tabItem = header.closest('.tab-item');
        const isActive = tabItem.classList.contains('active');
        
        if (isActive) {
          tabItem.classList.remove('active');
        } else {
          tabItem.classList.add('active');
        }
      });
    });
    
    // Initialize quest system
    initializeQuestSystem();
    
    initializeTutorialSystem();
  
    const room = document.querySelector('.room');
    const character = document.querySelector('.character-container');
    const charImg = document.getElementById('character-img');

    const frame = document.querySelector('.frame');
    let lastSparkleTime = 0;
    const sparkleInterval = 30;

    frame.addEventListener('mousemove', (e) => {
      const now = Date.now();
      if (now - lastSparkleTime > sparkleInterval) {
        createSparkle(e.clientX, e.clientY);
        lastSparkleTime = now;
      }
    });

    function createSparkle(x, y) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.style.left = x + 'px';
      sparkle.style.top = y + 'px';
      
      const variation = (Math.random() - 0.5) * 10;
      sparkle.style.left = (x + variation) + 'px';
      
      document.body.appendChild(sparkle);
      
      setTimeout(() => {
        sparkle.remove();
      }, 800);
    }

    const controller = window.MetaMeda;
    const savedStyle = localStorage.getItem("selectedStyle");
    let selectedCharacter = localStorage.getItem('selectedChampion') || null;
    
    async function loadRiotProfile() {
      const summonerData = localStorage.getItem("summonerData");
      if (!summonerData) {
        console.log("No summoner data found");
        return;
      }
      
      const data = JSON.parse(summonerData);
      
      document.getElementById("summoner-name").textContent = `${data.name}#${data.tagLine}` || "Unknown";
      document.getElementById("summoner-level-display").textContent = data.level || "‚Äî";
      document.getElementById("summoner-lp").textContent = data.lp || "0 LP";
      document.getElementById("summoner-wins").textContent = data.wins || "0";
      document.getElementById("summoner-losses").textContent = data.losses || "0";
      
      const rank = data.rank || "Unranked";
      document.getElementById("rank-text").textContent = rank;
      
      const rankBadgeLarge = document.getElementById('rank-badge-large');
      const rankMap = {
        'Iron': 'METAMEDIA/Rank=Iron.png',
        'Bronze': 'METAMEDIA/Rank=Bronze.png',
        'Silver': 'METAMEDIA/Rank=Silver.png',
        'Gold': 'METAMEDIA/Rank=Gold.png',
        'Platinum': 'METAMEDIA/Rank=Platinum.png',
        'Emerald': 'METAMEDIA/Rank=Emerald.png',
        'Diamond': 'METAMEDIA/Rank=Diamond.png',
        'Master': 'METAMEDIA/Rank=Master.png',
        'Grandmaster': 'METAMEDIA/Rank=Grandmaster.png',
        'Challenger': 'METAMEDIA/Rank=Challenger.png'
      };
      
      const baseRank = rank.split(' ')[0];
      const rankBadgePath = rankMap[baseRank] || 'METAMEDIA/lol.jpeg';
      rankBadgeLarge.style.backgroundImage = `url(${rankBadgePath})`;
      
      const badgeEl = document.getElementById('summoner-badge');
      
      if (selectedCharacter) {
        const championRenderUrl = `https://wiki.leagueoflegends.com/en-us/images/${selectedCharacter}_Render.png`;
        charImg.onerror = () => {
          console.warn(`Render image failed to load for ${selectedCharacter}, using thumbnail in orb`);
          charImg.classList.add('fallback-orb');
          charImg.src = `https://ddragon.leagueoflegends.com/cdn/14.1.1/img/champion/${selectedCharacter}.png`;
        };
        charImg.classList.remove('fallback-orb');
        charImg.src = championRenderUrl;
        console.log(`Restored selected champion: ${selectedCharacter} with render image`);
      } else if (data.profileIconUrl) {
        charImg.classList.add('fallback-orb');
        charImg.src = data.profileIconUrl;
        badgeEl.style.backgroundImage = `url(${data.profileIconUrl})`;
      } else {
        charImg.classList.add('fallback-orb');
        charImg.src = "./METAMEDIA/lol.jpeg";
        badgeEl.style.backgroundImage = `url(./METAMEDIA/lol.jpeg)`;
      }
      
      if (data.profileIconUrl && !selectedCharacter) {
        badgeEl.style.backgroundImage = `url(${data.profileIconUrl})`;
      }
      
      try {
        const accountRes = await fetch(`/.netlify/functions/riot-api?endpoint=/riot/account/v1/accounts/by-riot-id/${encodeURIComponent(data.name)}/${encodeURIComponent(data.tagLine)}&region=americas`);
        if (!accountRes.ok) throw new Error("Failed to get account data");
        
        const accountData = await accountRes.json();
        const puuid = accountData.puuid;
        
        const summonerRes = await fetch(`/.netlify/functions/riot-api?endpoint=/lol/summoner/v4/summoners/by-puuid/${puuid}&region=na1`);
        if (!summonerRes.ok) throw new Error("Failed to get summoner data");
        
        const summonerApiData = await summonerRes.json();
        const profileIconId = summonerApiData.profileIconId;
        
        const riotIconUrl = `https://ddragon.leagueoflegends.com/cdn/14.1.1/img/profileicon/${profileIconId}.png`;
        
        if (!selectedCharacter) {
          charImg.classList.add('fallback-orb');
          charImg.src = riotIconUrl;
        }
        
        badgeEl.style.backgroundImage = `url(${riotIconUrl})`;
        
        const updatedData = { ...data, profileIconUrl: riotIconUrl, puuid };
        localStorage.setItem("summonerData", JSON.stringify(updatedData));
        
        console.log("Profile icon updated from Riot API");
      } catch (err) {
        console.log("Using scraped profile icon:", err.message);
      }
    }
    
    loadRiotProfile();
    
    if (selectedCharacter) {
      loadChampionBackground(selectedCharacter);
    }
    
    // Initialize champion progress and lore system
    initializeChampionProgress();
    initializeLoreSystem();
    

// ===============================
// üéØ CHAMPION-SPECIFIC QUEST SYSTEM
// ===============================
function initializeQuestSystem() {
  const selectedChampion = localStorage.getItem('selectedChampion');
  
  if (!selectedChampion) {
    const questList = document.getElementById('quest-list');
    questList.innerHTML = '<p style="color: #ff9900; text-align: center;">Select a champion from the closet to view quests!</p>';
    return;
  }
  
  let championQuests = JSON.parse(localStorage.getItem('championQuests') || '{}');
  
  if (!championQuests[selectedChampion]) {
    championQuests[selectedChampion] = {
      quests: generateChampionQuests(selectedChampion),
      completedQuests: [],
      questLevel: 1,
      questPoints: 0
    };
  }
  
  const questData = championQuests[selectedChampion];
  
  checkQuestCompletion(questData, selectedChampion);
  renderQuests(questData, selectedChampion);
  updateQuestProgress(questData, selectedChampion);
  
  championQuests[selectedChampion] = questData;
  localStorage.setItem('championQuests', JSON.stringify(championQuests));
}

function generateChampionQuests(championName) {
  return [
    {
      id: `${championName}_1`,
      name: `Load Profile`,
      description: `View your League of Legends profile (Auto-completes on load)`,
      completed: false,
      active: true,
      manual: false
    },
    {
      id: `${championName}_2`,
      name: `Load Champion ‚Äî ${championName}`,
      description: `Select ${championName} from the Champion Closet (Restart Point)`,
      completed: false,
      active: true,
      manual: false
    },
    {
      id: `${championName}_3`,
      name: `Visit PC`,
      description: `Click on the PC hotspot to access desktop apps`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_4`,
      name: `Check All Tabs in Profile App`,
      description: `View Quests, Champion Progress, and Lore Box tabs`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_5`,
      name: `Review Lore Loot`,
      description: `Check your Lore Loot Box for unopened lore cards`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_6`,
      name: `Visit LoL Messenger`,
      description: `Access the Phone hotspot to open LoL Messenger`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_7`,
      name: `Add Friends`,
      description: `Connect with other League players through Messenger`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_8`,
      name: `Open Lore Treasure Chest`,
      description: `Unlock your first lore card from the Lore Loot Box`,
      completed: false,
      active: true,
      manual: true
    },
    {
      id: `${championName}_9`,
      name: `Complete Quest List with ${championName}`,
      description: `Finish all quests for ${championName} to restart with a new champion`,
      completed: false,
      active: true,
      manual: true
    }
  ];
}

function checkQuestCompletion(questData, championName) {
  const championProgress = JSON.parse(localStorage.getItem('championProgress') || '{}');
  const progress = championProgress[championName];
  
  if (!progress) return;
  
  questData.quests.forEach((quest, index) => {
    if (quest.completed) return;
    
    if (quest.id === `${championName}_1`) {
      const summonerData = localStorage.getItem("summonerData");
      if (summonerData) {
        completeQuest(questData, quest.id, championName);
      }
    }
    
    if (quest.id === `${championName}_2`) {
      const selectedChampion = localStorage.getItem('selectedChampion');
      if (selectedChampion === championName) {
        completeQuest(questData, quest.id, championName);
      }
    }
  });
}

function completeQuest(questData, questId, championName) {
  const quest = questData.quests.find(q => q.id === questId);
  if (!quest || quest.completed) return;
  
  quest.completed = true;
  quest.active = false;
  
  if (!questData.completedQuests.includes(questId)) {
    questData.completedQuests.push(questId);
    questData.questPoints += 1;
    
    unlockLoreForQuest(championName, questData.questPoints);
    
    let championProgress = JSON.parse(localStorage.getItem('championProgress') || '{}');
    if (!championProgress[championName]) {
      championProgress[championName] = {
        loreCollected: 0,
        totalLore: 9,
        progress: 0
      };
    }
    
    championProgress[championName].loreCollected = Math.min(
      championProgress[championName].loreCollected + 1,
      championProgress[championName].totalLore
    );
    championProgress[championName].progress = 
      (championProgress[championName].loreCollected / championProgress[championName].totalLore) * 100;
    
    localStorage.setItem('championProgress', JSON.stringify(championProgress));
    
    // Check if Quest 9 is completed (Complete Quest List)
    if (questId === `${championName}_9`) {
      showNotification(`üéâ Quest Chain Complete! Unlocking new champion for Quest 2...`);
      // Reset to Quest 2 (Load Champion) - the restart point
      questData.questLevel += 1;
      questData.questPoints = 0;
      showNotification(`üîÑ Returning to Quest 2: Select a new champion to continue!`);
    } else if (questData.questPoints >= 9) {
      questData.questLevel += 1;
      questData.questPoints = 0;
      showNotification(`üéâ Quest Level Up! ${championName} is now Quest Level ${questData.questLevel}!`);
    } else {
      showNotification(`‚úÖ Quest Complete: ${quest.name}!`);
    }
    
    const championQuests = JSON.parse(localStorage.getItem('championQuests') || '{}');
    championQuests[championName] = questData;
    localStorage.setItem('championQuests', JSON.stringify(championQuests));
    
    updateQuestNotification(questData);
    updateQuestProgress(questData, championName);
    renderQuests(questData, championName);
    
    initializeChampionProgress();
    initializeLoreSystem();
  }
}

async function unlockLoreForQuest(championName, questPointIndex) {
  let championLore = JSON.parse(localStorage.getItem('championLore') || '{}');
  
  if (!championLore[championName]) {
    championLore[championName] = [];
  }
  
  if (championLore[championName].length >= questPointIndex) {
    return;
  }
  
  let championLoreData = JSON.parse(localStorage.getItem('championLoreData') || '{}');
  if (!championLoreData[championName]) {
    await fetchChampionLore(championName);
  }
  
  const loreId = `${championName}_lore_${questPointIndex}`;
  championLore[championName].push(loreId);
  localStorage.setItem('championLore', JSON.stringify(championLore));
  
  let collectedLore = JSON.parse(localStorage.getItem('collectedLore') || '[]');
  if (!collectedLore.includes(loreId)) {
    collectedLore.push(loreId);
    localStorage.setItem('collectedLore', JSON.stringify(collectedLore));
  }
  
  showNotification(`üìú New lore unlocked for ${championName}!`);
}

function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.position = 'fixed';
  notification.style.top = '50%';
  notification.style.left = '50%';
  notification.style.transform = 'translate(-50%, -50%)';
  notification.style.background = 'rgba(0, 255, 255, 0.95)';
  notification.style.color = '#000';
  notification.style.padding = '20px 40px';
  notification.style.borderRadius = '12px';
  notification.style.fontSize = '18px';
  notification.style.fontWeight = 'bold';
  notification.style.zIndex = '99999';
  notification.style.boxShadow = '0 0 30px rgba(0, 255, 255, 0.8)';
  notification.style.animation = 'fadeInOut 3s ease-in-out';
  notification.textContent = message;
  
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }
  `;
  document.head.appendChild(style);
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
    style.remove();
  }, 3000);
}

function updateQuestNotification(questData) {
  const notification = document.getElementById('quest-notification');
  const hasActiveQuests = questData.quests.some(q => !q.completed);
  const hasCompletedQuests = questData.quests.some(q => q.completed && !q.notified);
  
  if (hasActiveQuests || hasCompletedQuests) {
    notification.style.display = 'flex';
  } else {
    notification.style.display = 'none';
  }
}

function renderQuests(questData, championName) {
  const questList = document.getElementById('quest-list');
  questList.innerHTML = '';
  
  const championHeader = document.createElement('div');
  championHeader.style.textAlign = 'center';
  championHeader.style.marginBottom = '12px';
  championHeader.style.padding = '8px';
  championHeader.style.background = 'rgba(0, 255, 255, 0.1)';
  championHeader.style.borderRadius = '8px';
  championHeader.style.color = '#00ffff';
  championHeader.style.fontWeight = 'bold';
  championHeader.textContent = `${championName} Quests`;
  questList.appendChild(championHeader);
  
  if (questData.quests.length === 0) {
    questList.innerHTML += '<p style="color: #aaa; text-align: center;">No quests available</p>';
    return;
  }
  
  questData.quests.forEach(quest => {
    const questItem = document.createElement('div');
    questItem.style.padding = '12px';
    questItem.style.background = quest.completed ? 'rgba(0, 255, 0, 0.1)' : 'rgba(0, 255, 255, 0.05)';
    questItem.style.border = quest.completed ? '1px solid rgba(0, 255, 0, 0.4)' : '1px solid rgba(0, 255, 255, 0.2)';
    questItem.style.borderRadius = '8px';
    questItem.style.marginBottom = '8px';
    questItem.style.transition = 'all 0.3s ease';
    
    if (quest.manual && !quest.completed) {
      questItem.style.cursor = 'pointer';
      questItem.addEventListener('mouseenter', () => {
        questItem.style.background = 'rgba(0, 255, 255, 0.15)';
        questItem.style.transform = 'translateX(4px)';
      });
      questItem.addEventListener('mouseleave', () => {
        questItem.style.background = 'rgba(0, 255, 255, 0.05)';
        questItem.style.transform = 'translateX(0)';
      });
      questItem.addEventListener('click', () => {
        completeQuest(questData, quest.id, championName);
      });
    }
    
    const questTitle = document.createElement('div');
    questTitle.style.fontSize = '13px';
    questTitle.style.fontWeight = '700';
    questTitle.style.color = quest.completed ? '#0f0' : '#00ffff';
    questTitle.style.textTransform = 'uppercase';
    questTitle.style.marginBottom = '6px';
    questTitle.style.textShadow = '0 0 4px rgba(0, 255, 255, 0.6)';
    questTitle.textContent = `${quest.completed ? '‚úì' : '‚óã'} ${quest.name}`;
    
    const questDesc = document.createElement('div');
    questDesc.style.fontSize = '11px';
    questDesc.style.color = 'rgba(255, 255, 255, 0.7)';
    questDesc.style.lineHeight = '1.4';
    questDesc.textContent = quest.description;
    
    questItem.appendChild(questTitle);
    questItem.appendChild(questDesc);
    questList.appendChild(questItem);
  });
}

function updateQuestProgress(questData, championName) {
  const progressFill = document.getElementById('quest-progress-fill');
  const progressText = document.getElementById('quest-progress-text');
  const progressLabel = document.getElementById('quest-progress-label');
  
  const progress = (questData.questPoints / 9) * 100;
  
  progressFill.style.width = `${progress}%`;
  progressText.textContent = `${questData.questPoints}/9`;
  progressLabel.textContent = `${championName} - Quest Level ${questData.questLevel}`;
  
  updateTutorialForQuest(questData);
}


function initializeTutorialSystem() {
  const tutorialBox = document.getElementById('tutorial-info-box');
  const tutorialClose = document.getElementById('tutorial-close');
  
  tutorialClose.addEventListener('click', () => {
    tutorialBox.classList.remove('active');
  });
  
  const selectedChampion = localStorage.getItem('selectedChampion');
  
  if (!selectedChampion) {
    showTutorialMessage({
      title: 'Welcome to Home Room!',
      content: `
        <div class="tutorial-info-box-step">
          <p><span class="tutorial-info-box-highlight">Step 1:</span> Click on the <span class="tutorial-info-box-highlight">STYLE</span> hotspot to open the Champion Closet.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p><span class="tutorial-info-box-highlight">Step 2:</span> Select a champion from your recent match to begin your quest journey.</p>
        </div>
        <p>Your quests and lore rewards will automatically track as you progress!</p>
      `
    });
  } else {
    const championQuests = JSON.parse(localStorage.getItem('championQuests') || '{}');
    const questData = championQuests[selectedChampion];
    
    if (questData) {
      updateTutorialForQuest(questData);
    }
  }
}

function showTutorialMessage(message) {
  const tutorialBox = document.getElementById('tutorial-info-box');
  const tutorialScroll = document.getElementById('tutorial-scroll');
  
  const plainText = convertHtmlToPlainText(message.content);
  const messageText = `${message.title || 'Quest Guide'}: ${plainText}`;
  
  const currentMessage = tutorialScroll.querySelector('.tutorial-message')?.textContent;
  
  if (currentMessage === messageText) {
    return;
  }
  
  tutorialScroll.innerHTML = `
    <div class="tutorial-message">${messageText}</div>
  `;
  
  tutorialScroll.classList.remove('scrolling');
  void tutorialScroll.offsetWidth;
  tutorialScroll.classList.add('scrolling');
  
  tutorialBox.classList.remove('active');
  void tutorialBox.offsetWidth;
  tutorialBox.classList.add('active');
}

function convertHtmlToPlainText(html) {
  const temp = document.createElement('div');
  temp.innerHTML = html;
  
  const steps = temp.querySelectorAll('.tutorial-info-box-step');
  const highlights = temp.querySelectorAll('.tutorial-info-box-highlight');
  
  steps.forEach(step => {
    step.replaceWith(` ${step.textContent.trim()} `);
  });
  
  highlights.forEach(highlight => {
    const span = document.createElement('span');
    span.className = 'tutorial-info-box-highlight';
    span.textContent = highlight.textContent;
    highlight.replaceWith(span);
  });
  
  return temp.textContent.replace(/\s+/g, ' ').trim();
}

function updateTutorialForQuest(questData) {
  if (!questData || !questData.quests) return;
  
  const activeQuest = questData.quests.find(q => !q.completed);
  
  if (!activeQuest) {
    showTutorialMessage({
      title: 'All Quests Complete!',
      content: `
        <p>üéâ You've completed all available quests!</p>
        <div class="tutorial-info-box-step">
          <p>Return to the <span class="tutorial-info-box-highlight">STYLE</span> hotspot to select a new champion and continue your adventure.</p>
        </div>
      `
    });
    return;
  }
  
  const lastActiveQuestId = localStorage.getItem('lastActiveQuestId');
  const shouldScroll = lastActiveQuestId && lastActiveQuestId !== activeQuest.id;
  
  localStorage.setItem('lastActiveQuestId', activeQuest.id);
  
  const questTutorials = {
    '_1': {
      title: 'Quest 1: Profile Loaded',
      content: `
        <p>‚úÖ Your profile has been automatically loaded!</p>
        <div class="tutorial-info-box-step">
          <p><span class="tutorial-info-box-highlight">Next:</span> Select a champion from the Champion Closet to continue.</p>
        </div>
      `
    },
    '_2': {
      title: 'Quest 2: Load Champion',
      content: `
        <div class="tutorial-info-box-step">
          <p>Click the <span class="tutorial-info-box-highlight">STYLE</span> hotspot at the bottom of the screen.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Select a champion from your recent match to unlock quests and lore.</p>
        </div>
      `
    },
    '_3': {
      title: 'Quest 3: Visit PC',
      content: `
        <div class="tutorial-info-box-step">
          <p>Move to the <span class="tutorial-info-box-highlight">PC</span> hotspot (left side).</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Click on it to access desktop apps and complete this quest.</p>
        </div>
        <p>Use arrow keys or click to move between hotspots!</p>
      `
    },
    '_4': {
      title: 'Quest 4: Check All Tabs',
      content: `
        <div class="tutorial-info-box-step">
          <p>Open the <span class="tutorial-info-box-highlight">Quests</span>, <span class="tutorial-info-box-highlight">Champion Progress</span>, and <span class="tutorial-info-box-highlight">Lore Box</span> tabs at the top center.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Review your progress and available lore cards.</p>
        </div>
        <p>Click each tab dropdown to explore!</p>
      `
    },
    '_5': {
      title: 'Quest 5: Review Lore Loot',
      content: `
        <div class="tutorial-info-box-step">
          <p>Open the <span class="tutorial-info-box-highlight">Lore Box</span> tab.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Check which lore cards you've unlocked by completing quests.</p>
        </div>
        <p>Each quest completion unlocks a new lore fragment!</p>
      `
    },
    '_6': {
      title: 'Quest 6: Visit LoL Messenger',
      content: `
        <div class="tutorial-info-box-step">
          <p>Move to the <span class="tutorial-info-box-highlight">PHONE</span> hotspot (right side).</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Click on it to open LoL Messenger.</p>
        </div>
        <p>Coming soon: Connect with other League players!</p>
      `
    },
    '_7': {
      title: 'Quest 7: Add Friends',
      content: `
        <div class="tutorial-info-box-step">
          <p>Connect with other League of Legends players through Messenger.</p>
        </div>
        <p>Feature coming soon - stay tuned!</p>
      `
    },
    '_8': {
      title: 'Quest 8: Open Lore Treasure',
      content: `
        <div class="tutorial-info-box-step">
          <p>Open the <span class="tutorial-info-box-highlight">Lore Box</span> tab.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Click on an unlocked lore card to read the full story.</p>
        </div>
        <p>Discover your champion's legend!</p>
      `
    },
    '_9': {
      title: 'Quest 9: Complete Quest List',
      content: `
        <div class="tutorial-info-box-step">
          <p>Complete all remaining quests with your champion.</p>
        </div>
        <div class="tutorial-info-box-step">
          <p>Once done, you'll restart at <span class="tutorial-info-box-highlight">Quest 2</span> with a new champion!</p>
        </div>
        <p>Collect lore for all your favorite champions!</p>
      `
    }
  };
  
  const questIdSuffix = activeQuest.id.substring(activeQuest.id.lastIndexOf('_'));
  const tutorial = questTutorials[questIdSuffix];
  
  if (tutorial) {
    if (shouldScroll) {
      const tutorialScroll = document.getElementById('tutorial-scroll');
      tutorialScroll.classList.add('scrolling');
    }
    showTutorialMessage(tutorial);
  } else {
    if (shouldScroll) {
      const tutorialScroll = document.getElementById('tutorial-scroll');
      tutorialScroll.classList.add('scrolling');
    }
    showTutorialMessage({
      title: 'Active Quest',
      content: `
        <p><span class="tutorial-info-box-highlight">${activeQuest.name}</span></p>
        <p>${activeQuest.description}</p>
      `
    });
  }
}


// ===============================
// üèÜ CHAMPION PROGRESS SYSTEM
// ===============================
async function initializeChampionProgress() {
  const progressContainer = document.querySelector('#tab-champions .tab-content-inner');
  
  // Get champion progress from localStorage or initialize
  let championProgress = JSON.parse(localStorage.getItem('championProgress') || '{}');
  
  // Fetch champions from recent match
  const summonerData = localStorage.getItem("summonerData");
  if (!summonerData) {
    progressContainer.innerHTML = '<p style="color: #ff6b6b;">No summoner data found. Please login first.</p>';
    return;
  }

  const data = JSON.parse(summonerData);
  const puuid = data.puuid;

  if (!puuid) {
    progressContainer.innerHTML = '<p style="color: #ff6b6b;">PUUID not found. Please refresh your profile.</p>';
    return;
  }

  try {
    const matchIdsRes = await fetch(`/.netlify/functions/riot-api?endpoint=/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=1&region=americas`);
    if (!matchIdsRes.ok) throw new Error("Failed to fetch match IDs");
    
    const matchIds = await matchIdsRes.json();
    
    if (!matchIds || matchIds.length === 0) {
      progressContainer.innerHTML = '<p style="color: #aaa;">No recent matches found.</p>';
      return;
    }

    const recentMatchId = matchIds[0];
    const matchRes = await fetch(`/.netlify/functions/riot-api?endpoint=/lol/match/v5/matches/${recentMatchId}&region=americas`);
    if (!matchRes.ok) throw new Error("Failed to fetch match details");
    
    const matchData = await matchRes.json();
    const participants = matchData.info.participants;
    const summoner = participants.find(p => p.puuid === puuid);
    
    if (!summoner) {
      progressContainer.innerHTML = '<p style="color: #ff6b6b;">Could not find summoner in match.</p>';
      return;
    }

    const teamId = summoner.teamId;
    const teamChampions = participants.filter(p => p.teamId === teamId);

    const championsRes = await fetch('https://ddragon.leagueoflegends.com/cdn/14.1.1/data/en_US/champion.json');
    if (!championsRes.ok) throw new Error("Failed to fetch champion data");
    
    const championsData = await championsRes.json();
    const championMap = {};
    
    for (const champKey in championsData.data) {
      const champ = championsData.data[champKey];
      championMap[champ.key] = champ.id;
    }

    progressContainer.innerHTML = '';

    teamChampions.forEach(participant => {
      const championId = participant.championId.toString();
      const championName = championMap[championId];
      
      if (championName) {
        // Initialize progress if not exists
        if (!championProgress[championName]) {
          championProgress[championName] = {
            loreCollected: 0,
            totalLore: 9,
            progress: 0
          };
        }

        const progress = championProgress[championName];
        const progressPercent = (progress.loreCollected / progress.totalLore) * 100;

        const progressItem = document.createElement('div');
        progressItem.className = 'champion-progress-item';
        progressItem.innerHTML = `
          <div class="champion-progress-icon">
            <img src="https://ddragon.leagueoflegends.com/cdn/14.1.1/img/champion/${championName}.png" alt="${championName}">
          </div>
          <div class="champion-progress-details">
            <div class="champion-progress-name">${championName}</div>
            <div class="champion-progress-bar-container">
              <div class="champion-progress-bar-fill" style="width: ${progressPercent}%"></div>
              <div class="champion-progress-text">${progress.loreCollected}/${progress.totalLore} Lore</div>
            </div>
          </div>
        `;
        
        progressContainer.appendChild(progressItem);
      }
    });

    // Save to localStorage
    localStorage.setItem('championProgress', JSON.stringify(championProgress));
    
  } catch (err) {
    console.error('Error loading champion progress:', err);
    progressContainer.innerHTML = `<p style="color: #ff6b6b;">Error: ${err.message}</p>`;
  }
}

// ===============================
// üìú CHAMPION-SPECIFIC LORE SYSTEM WITH WIKI SCRAPER
// ===============================
async function initializeLoreSystem() {
  const loreContainer = document.querySelector('#tab-lore .tab-content-inner');
  const selectedChampion = localStorage.getItem('selectedChampion');
  
  if (!selectedChampion) {
    loreContainer.innerHTML = '<p style="color: #ff9900; text-align: center;">Select a champion from the closet to view their lore!</p>';
    return;
  }
  
  let championLore = JSON.parse(localStorage.getItem('championLore') || '{}');
  let collectedLore = JSON.parse(localStorage.getItem('collectedLore') || '[]');
  let championLoreData = JSON.parse(localStorage.getItem('championLoreData') || '{}');
  
  const championProgress = JSON.parse(localStorage.getItem('championProgress') || '{}');
  const progress = championProgress[selectedChampion];
  
  if (!progress) {
    loreContainer.innerHTML = '<p style="color: #aaa; text-align: center;">No lore available for this champion yet.</p>';
    return;
  }
  
  const championQuests = JSON.parse(localStorage.getItem('championQuests') || '{}');
  const questData = championQuests[selectedChampion];
  
  if (questData) {
    questData.quests.forEach((quest, index) => {
      if (quest.completed && index < 2) {
        const loreId = `${selectedChampion}_lore_${index + 1}`;
        if (!collectedLore.includes(loreId)) {
          collectedLore.push(loreId);
          if (!championLore[selectedChampion]) {
            championLore[selectedChampion] = [];
          }
          if (!championLore[selectedChampion].includes(loreId)) {
            championLore[selectedChampion].push(loreId);
          }
        }
      }
    });
    
    localStorage.setItem('collectedLore', JSON.stringify(collectedLore));
    localStorage.setItem('championLore', JSON.stringify(championLore));
  }
  
  if (!championLoreData[selectedChampion]) {
    loreContainer.innerHTML = '<p style="color: #aaa; text-align: center;">Loading lore from League of Legends Wiki...</p>';
    await fetchChampionLore(selectedChampion);
    championLoreData = JSON.parse(localStorage.getItem('championLoreData') || '{}');
  }
  
  const lorePieces = generateChampionLore(selectedChampion, championLoreData[selectedChampion]);
  
  loreContainer.innerHTML = '';
  
  const loreHeader = document.createElement('div');
  loreHeader.style.textAlign = 'center';
  loreHeader.style.marginBottom = '12px';
  loreHeader.style.padding = '8px';
  loreHeader.style.background = 'rgba(0, 255, 255, 0.1)';
  loreHeader.style.borderRadius = '8px';
  loreHeader.style.color = '#00ffff';
  loreHeader.style.fontWeight = 'bold';
  loreHeader.textContent = `${selectedChampion} Lore Collection`;
  loreContainer.appendChild(loreHeader);
  
  lorePieces.forEach((lore, index) => {
    const loreId = `${selectedChampion}_lore_${index + 1}`;
    const isCollected = collectedLore.includes(loreId);
    
    const loreItem = document.createElement('div');
    loreItem.className = `lore-item ${isCollected ? 'collected' : ''}`;
    
    if (isCollected) {
      loreItem.innerHTML = `
        <div class="lore-item-title">${lore.title}</div>
        <div class="lore-item-preview">${lore.preview}</div>
      `;
      
      loreItem.addEventListener('click', () => {
        showLoreCardOverlay(lore, selectedChampion);
      });
    } else {
      loreItem.innerHTML = `
        <div class="lore-item-title">??? Locked Lore Piece ${index + 1}</div>
        <div class="lore-item-preview">Complete quests to unlock this lore piece...</div>
      `;
      loreItem.style.opacity = '0.5';
      loreItem.style.cursor = 'not-allowed';
    }
    
    loreContainer.appendChild(loreItem);
  });
}

async function fetchChampionLore(championName) {
  try {
    const response = await fetch(`/.netlify/functions/lore-scraper?champion=${encodeURIComponent(championName)}`);
    
    if (!response.ok) {
      console.warn(`Failed to fetch lore for ${championName}`);
      return null;
    }
    
    const loreData = await response.json();
    
    let championLoreData = JSON.parse(localStorage.getItem('championLoreData') || '{}');
    championLoreData[championName] = loreData;
    localStorage.setItem('championLoreData', JSON.stringify(championLoreData));
    
    console.log(`Lore fetched and cached for ${championName}`);
    return loreData;
  } catch (error) {
    console.error(`Error fetching lore for ${championName}:`, error);
    return null;
  }
}

function generateChampionLore(championName, loreData) {
  const lorePieces = [];
  
  if (loreData && loreData.loreSnippets && loreData.loreSnippets.length > 0) {
    loreData.loreSnippets.slice(0, 9).forEach((snippet, index) => {
      const preview = snippet.substring(0, 80) + (snippet.length > 80 ? '...' : '');
      lorePieces.push({
        title: `${championName} - Lore Fragment ${index + 1}`,
        preview: preview,
        content: snippet,
        imageUrl: `https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${championName}_${index}.jpg`,
        questNumber: index + 1
      });
    });
  }
  
  while (lorePieces.length < 9) {
    const index = lorePieces.length;
    lorePieces.push({
      title: `${championName} - Quest ${index + 1}`,
      preview: `Unlock this lore by completing quest ${index + 1}...`,
      content: `Complete quest ${index + 1} to reveal more about ${championName}'s story and legend.`,
      imageUrl: `https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${championName}_${index}.jpg`,
      questNumber: index + 1
    });
  }
  
  return lorePieces;
}

async function getChampionMetadata(championName) {
  try {
    const cacheKey = `championMetadata_${championName}`;
    const cached = localStorage.getItem(cacheKey);
    
    if (cached) {
      const cachedData = JSON.parse(cached);
      if (Date.now() - cachedData.timestamp < 86400000) {
        return cachedData.data;
      }
    }
    
    const response = await fetch(`https://ddragon.leagueoflegends.com/cdn/14.1.1/data/en_US/champion/${championName}.json`);
    
    if (!response.ok) {
      console.warn(`Failed to fetch metadata for ${championName}`);
      return null;
    }
    
    const data = await response.json();
    const championData = data.data[championName];
    
    const cacheData = {
      timestamp: Date.now(),
      data: championData
    };
    localStorage.setItem(cacheKey, JSON.stringify(cacheData));
    
    return championData;
  } catch (error) {
    console.error(`Error fetching champion metadata for ${championName}:`, error);
    return null;
  }
}

async function showLoreCardOverlay(lore, championName) {
  const overlay = document.createElement('div');
  overlay.style.position = 'fixed';
  overlay.style.top = '0';
  overlay.style.left = '0';
  overlay.style.width = '100%';
  overlay.style.height = '100%';
  overlay.style.background = 'rgba(0, 0, 0, 0.9)';
  overlay.style.display = 'flex';
  overlay.style.justifyContent = 'center';
  overlay.style.alignItems = 'center';
  overlay.style.zIndex = '99999';
  overlay.style.animation = 'fadeIn 0.3s ease';
  
  const card = document.createElement('div');
  card.style.position = 'relative';
  card.style.maxWidth = '600px';
  card.style.width = '90%';
  card.style.maxHeight = '80vh';
  card.style.background = 'rgba(20, 20, 20, 0.95)';
  card.style.border = '3px solid #00ffff';
  card.style.borderRadius = '12px';
  card.style.padding = '20px';
  card.style.boxShadow = '0 0 40px rgba(0, 255, 255, 0.6)';
  card.style.overflowY = 'auto';
  card.style.color = '#fff';
  
  const closeBtn = document.createElement('button');
  closeBtn.textContent = '√ó';
  closeBtn.style.position = 'absolute';
  closeBtn.style.top = '10px';
  closeBtn.style.right = '10px';
  closeBtn.style.background = 'none';
  closeBtn.style.border = 'none';
  closeBtn.style.color = '#00ffff';
  closeBtn.style.fontSize = '32px';
  closeBtn.style.cursor = 'pointer';
  closeBtn.style.transition = 'transform 0.2s ease';
  closeBtn.addEventListener('mouseenter', () => {
    closeBtn.style.transform = 'scale(1.2)';
  });
  closeBtn.addEventListener('mouseleave', () => {
    closeBtn.style.transform = 'scale(1)';
  });
  closeBtn.addEventListener('click', () => {
    overlay.remove();
  });
  
  const cardImage = document.createElement('img');
  cardImage.src = lore.imageUrl || `https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${championName}_0.jpg`;
  cardImage.style.width = '100%';
  cardImage.style.borderRadius = '8px';
  cardImage.style.marginBottom = '12px';
  cardImage.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.4)';
  
  const imageDescription = document.createElement('div');
  const skinNumber = lore.questNumber - 1;
  
  const championMetaData = await getChampionMetadata(championName);
  const skinName = championMetaData?.skins?.[skinNumber]?.name || (skinNumber === 0 ? 'Classic' : `Skin ${skinNumber}`);
  const championTitle = championMetaData?.title || '';
  const championRoles = championMetaData?.tags?.join(', ') || '';
  const championDifficulty = championMetaData?.info?.difficulty || 0;
  
  imageDescription.innerHTML = `
    <div style="font-weight: bold; margin-bottom: 4px;">${championName}${championTitle ? ` - ${championTitle}` : ''}</div>
    <div style="margin-bottom: 4px;">${skinName}</div>
    ${championRoles ? `<div style="font-size: 11px; color: rgba(0, 255, 255, 0.8); margin-bottom: 4px;">${championRoles}</div>` : ''}
    ${championDifficulty > 0 ? `<div style="font-size: 11px; color: rgba(255, 255, 255, 0.5);">Difficulty: ${'‚òÖ'.repeat(championDifficulty)}${'‚òÜ'.repeat(10 - championDifficulty)}</div>` : ''}
  `;
  imageDescription.style.fontSize = '13px';
  imageDescription.style.color = 'rgba(255, 255, 255, 0.7)';
  imageDescription.style.textAlign = 'center';
  imageDescription.style.marginBottom = '16px';
  imageDescription.style.fontStyle = 'italic';
  imageDescription.style.padding = '12px';
  imageDescription.style.background = 'rgba(0, 255, 255, 0.05)';
  imageDescription.style.borderRadius = '6px';
  imageDescription.style.border = '1px solid rgba(0, 255, 255, 0.2)';
  
  const cardTitle = document.createElement('h2');
  cardTitle.textContent = lore.title;
  cardTitle.style.color = '#00ffff';
  cardTitle.style.textShadow = '0 0 10px rgba(0, 255, 255, 0.8)';
  cardTitle.style.marginBottom = '12px';
  cardTitle.style.fontSize = '20px';
  cardTitle.style.textAlign = 'center';
  
  const questLabel = document.createElement('div');
  questLabel.textContent = `Quest ${lore.questNumber}/9`;
  questLabel.style.fontSize = '12px';
  questLabel.style.color = '#aaa';
  questLabel.style.textAlign = 'center';
  questLabel.style.marginBottom = '16px';
  questLabel.style.textTransform = 'uppercase';
  questLabel.style.letterSpacing = '1px';
  
  const cardContent = document.createElement('p');
  cardContent.textContent = lore.content;
  cardContent.style.color = 'rgba(255, 255, 255, 0.9)';
  cardContent.style.lineHeight = '1.6';
  cardContent.style.fontSize = '14px';
  cardContent.style.textAlign = 'justify';
  
  card.appendChild(closeBtn);
  card.appendChild(cardImage);
  card.appendChild(imageDescription);
  card.appendChild(cardTitle);
  card.appendChild(questLabel);
  card.appendChild(cardContent);
  overlay.appendChild(card);
  
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) {
      overlay.remove();
    }
  });
  
  document.body.appendChild(overlay);
}


async function loadClosetChampions() {
  const summonerData = localStorage.getItem("summonerData");
  if (!summonerData) {
    document.getElementById("closet-champions").innerHTML = '<p style="color: #ff6b6b;">No summoner data found. Please login first.</p>';
    return;
  }

  const data = JSON.parse(summonerData);
  const puuid = data.puuid;

  if (!puuid) {
    document.getElementById("closet-champions").innerHTML = '<p style="color: #ff6b6b;">PUUID not found. Please refresh your profile.</p>';
    return;
  }

  try {
    const matchIdsRes = await fetch(`/.netlify/functions/riot-api?endpoint=/lol/match/v5/matches/by-puuid/${puuid}/ids?start=0&count=1&region=americas`);
    if (!matchIdsRes.ok) throw new Error("Failed to fetch match IDs");
    
    const matchIds = await matchIdsRes.json();
    
    if (!matchIds || matchIds.length === 0) {
      document.getElementById("closet-champions").innerHTML = '<p style="color: #aaa;">No recent matches found.</p>';
      return;
    }

    const recentMatchId = matchIds[0];
    
    const matchRes = await fetch(`/.netlify/functions/riot-api?endpoint=/lol/match/v5/matches/${recentMatchId}&region=americas`);
    if (!matchRes.ok) throw new Error("Failed to fetch match details");
    
    const matchData = await matchRes.json();
    
    const participants = matchData.info.participants;
    const summoner = participants.find(p => p.puuid === puuid);
    
    if (!summoner) {
      document.getElementById("closet-champions").innerHTML = '<p style="color: #ff6b6b;">Could not find summoner in match.</p>';
      return;
    }

    const teamId = summoner.teamId;
    const teamChampions = participants.filter(p => p.teamId === teamId);

    const championsRes = await fetch('https://ddragon.leagueoflegends.com/cdn/14.1.1/data/en_US/champion.json');
    if (!championsRes.ok) throw new Error("Failed to fetch champion data");
    
    const championsData = await championsRes.json();
    const championMap = {};
    
    for (const champKey in championsData.data) {
      const champ = championsData.data[champKey];
      championMap[champ.key] = champ.id;
    }

    const closetContainer = document.getElementById("closet-champions");
    closetContainer.innerHTML = '';

    teamChampions.forEach(participant => {
      const championId = participant.championId.toString();
      const championName = championMap[championId];
      
      if (championName) {
        const championCard = document.createElement('div');
        championCard.className = 'champion-card';
        championCard.setAttribute('data-name', championName);
        championCard.setAttribute('data-champion-id', championId);
        
        if (selectedCharacter === championName) {
          championCard.classList.add('selected');
        }
        
        const championImg = document.createElement('img');
        championImg.src = `https://ddragon.leagueoflegends.com/cdn/14.1.1/img/champion/${championName}.png`;
        championImg.alt = championName;
        
        championCard.addEventListener('click', async () => {
          document.querySelectorAll('.champion-card').forEach(card => {
            card.classList.remove('selected');
          });
          
          championCard.classList.add('selected');
          
          const charImg = document.getElementById('character-img');
          const renderUrl = `https://wiki.leagueoflegends.com/en-us/images/${championName}_Render.png`;
          
          charImg.onerror = () => {
            console.warn(`Render image failed to load for ${championName}, using thumbnail in orb`);
            charImg.classList.add('fallback-orb');
            charImg.src = `https://ddragon.leagueoflegends.com/cdn/14.1.1/img/champion/${championName}.png`;
          };
          
          charImg.classList.remove('fallback-orb');
          charImg.src = renderUrl;
          
          selectedCharacter = championName;
          localStorage.setItem('selectedChampion', championName);
          
          console.log(`Selected champion: ${championName}, using render image`);
          
          await loadChampionBackground(championName);
          
          initializeQuestSystem();
          initializeChampionProgress();
          initializeLoreSystem();
          initializeTutorialSystem();
        });
        
        championCard.appendChild(championImg);
        closetContainer.appendChild(championCard);
      }
    });

    console.log(`Loaded ${teamChampions.length} champions from recent match`);
    
  } catch (err) {
    console.error('Error loading closet champions:', err);
    document.getElementById("closet-champions").innerHTML = `<p style="color: #ff6b6b;">Error: ${err.message}</p>`;
  }
}

async function loadChampionBackground(championName) {
  try {
    const cachedBackgrounds = JSON.parse(localStorage.getItem('championBackgrounds') || '{}');
    
    if (cachedBackgrounds[championName]) {
      console.log(`Using cached background for ${championName}`);
      applyChampionBackground(cachedBackgrounds[championName]);
      return;
    }
    
    console.log(`Fetching background for ${championName} from wiki...`);
    
    const response = await fetch(`/.netlify/functions/champion-bg-scraper?champion=${encodeURIComponent(championName)}`);
    
    if (!response.ok) {
      console.warn(`Failed to fetch background for ${championName}`);
      return;
    }
    
    const data = await response.json();
    
    if (data.backgroundUrl) {
      cachedBackgrounds[championName] = data.backgroundUrl;
      localStorage.setItem('championBackgrounds', JSON.stringify(cachedBackgrounds));
      
      applyChampionBackground(data.backgroundUrl);
      console.log(`Background loaded and cached for ${championName}`);
    }
  } catch (error) {
    console.error(`Error loading background for ${championName}:`, error);
  }
}

function applyChampionBackground(backgroundUrl) {
  const room = document.querySelector('.room');
  if (room) {
    room.style.backgroundImage = `url('${backgroundUrl}')`;
    room.style.backgroundSize = 'cover';
    room.style.backgroundPosition = 'center';
    room.style.backgroundRepeat = 'no-repeat';
  }
}

const spot2 = document.getElementById('spot2');
if (spot2) {
  spot2.addEventListener('click', () => {
    loadClosetChampions();
  });
}


  //==================================================================
    const platformPositions = [20, 50, 80];
    let currentPlatform = 1;

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
        if (currentPlatform > 0) {
          currentPlatform--;
          updateCharacterPosition();
        }
      } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
        if (currentPlatform < 2) {
          currentPlatform++;
          updateCharacterPosition();
        }
      } else if (e.key === 'Enter') {
        const nearHotspot = document.querySelector('.hotspot.near');
        if (nearHotspot) {
          nearHotspot.click();
        }
      }
    });

    document.addEventListener('click', e => {
      const rect = room.getBoundingClientRect();
      const clickX = ((e.clientX - rect.left) / rect.width) * 100;
      
      if (clickX < 35) {
        currentPlatform = 0;
      } else if (clickX < 65) {
        currentPlatform = 1;
      } else {
        currentPlatform = 2;
      }
      updateCharacterPosition();
    });

    room.addEventListener('mousemove', e => {
      const rect = room.getBoundingClientRect();
      const mouseX = ((e.clientX - rect.left) / rect.width) * 100;
      
      if (mouseX < 35) {
        currentPlatform = 0;
      } else if (mouseX < 65) {
        currentPlatform = 1;
      } else {
        currentPlatform = 2;
      }
      updateCharacterPosition();
    });

    let lastCharacterX = null;
    let lastCharacterSparkleTime = 0;
    const characterSparkleInterval = 50;

    function updateCharacterPosition() {
      const characterContainer = document.querySelector('.character-container');
      if (characterContainer) {
        const oldLeft = parseFloat(characterContainer.style.left) || 50;
        const newLeft = platformPositions[currentPlatform];
        characterContainer.style.left = `${newLeft}%`;
        
        if (oldLeft !== newLeft) {
          createCharacterSparkleTrail(characterContainer);
        }
      }
      checkHotspotProximity();
    }

    function createCharacterSparkleTrail(container) {
      const rect = container.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      container.classList.add('moving');
      setTimeout(() => {
        container.classList.remove('moving');
      }, 400);
      
      const sparkleCount = 15;
      for (let i = 0; i < sparkleCount; i++) {
        setTimeout(() => {
          createCharacterSparkle(centerX, centerY);
        }, i * 30);
      }
    }

    function createCharacterSparkle(x, y) {
      const sparkle = document.createElement('div');
      const colors = ['blue', 'purple', 'black', 'pink'];
      const colorClass = colors[Math.floor(Math.random() * colors.length)];
      sparkle.className = `character-sparkle ${colorClass}`;
      
      const offsetX = (Math.random() - 0.5) * 80;
      const offsetY = (Math.random() - 0.5) * 80;
      
      sparkle.style.left = (x + offsetX) + 'px';
      sparkle.style.top = (y + offsetY) + 'px';
      
      document.body.appendChild(sparkle);
      
      setTimeout(() => {
        sparkle.remove();
      }, 1200);
    }

    updateCharacterPosition();


 

// üîç Proximity detection for hotspot labels
function checkHotspotProximity() {
  const character = document.querySelector('.character-container');
  const hotspots = document.querySelectorAll('.hotspot');
  const proximityThreshold = 150;

  const charRect = character.getBoundingClientRect();
  const charCenterX = charRect.left + charRect.width / 2;
  const charCenterY = charRect.top + charRect.height / 2;

  hotspots.forEach(hotspot => {
    const hotspotRect = hotspot.getBoundingClientRect();
    const hotspotCenterX = hotspotRect.left + hotspotRect.width / 2;
    const hotspotCenterY = hotspotRect.top + hotspotRect.height / 2;

    const distance = Math.hypot(
      charCenterX - hotspotCenterX,
      charCenterY - hotspotCenterY
    );

    if (distance < proximityThreshold) {
      hotspot.classList.add('near');
    } else {
      hotspot.classList.remove('near');
    }
  });
}
  });


//===========================================
// üîπ Hotspot -> Overlay Control
// ===============================
const hotspots = document.querySelectorAll('.hotspot');
const screens = document.querySelectorAll('.overlay-screen');

hotspots.forEach((spot, i) => {
  spot.addEventListener('click', () => {
    // Hide any open screen first
    screens.forEach(s => s.classList.remove('active'));
    // Show this one
    screens[i].classList.add('active');
  });
});

// Close buttons
document.querySelectorAll('.close-btn').forEach(btn => {
  btn.addEventListener('click', e => {
    const overlay = e.target.closest('.overlay-screen');
    overlay.classList.remove('active');

    // üßπ also close any mini apps if this was the PC screen
    if (overlay.id === "screen1") {
      closeAllApps();
    }
  });
});


// Optional: ESC to close
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    screens.forEach(s => s.classList.remove('active'));
  }
});

    
//======MiniApps==============================================================

// Handle opening mini apps
document.querySelectorAll('.app-icon').forEach(icon => {
  icon.addEventListener('click', () => {
    const appName = icon.dataset.app;
    openApp(appName);
  });
});

async function openApp(appName) {
  // close previous app windows inside the mini-pc
  document.querySelectorAll('.app-window').forEach(w => w.remove());

  const win = document.createElement('div');
  win.className = 'app-window';

  // üß© LoL ID Archive mini-app
 if (appName === "lolid") {
  const summonerData = JSON.parse(localStorage.getItem("summonerData") || '{}');
  const summonerName = summonerData.name || "Unknown";
  const tagLine = summonerData.tagLine || "NA1";
  const level = summonerData.level || "‚Äî";
  const rank = summonerData.rank || "Unranked";
  const lp = summonerData.lp || "0";
  const wins = summonerData.wins || "0";
  const losses = summonerData.losses || "0";
  const winRate = wins && losses ? Math.round((parseInt(wins) / (parseInt(wins) + parseInt(losses))) * 100) : 0;
  
  let behaviorData = null;
  try {
    const behaviorRes = await fetch(`/.netlify/functions/behavior-scraper?gameName=${encodeURIComponent(summonerName)}&tagLine=${encodeURIComponent(tagLine)}&region=na`);
    if (behaviorRes.ok) {
      behaviorData = await behaviorRes.json();
      console.log('Behavior data loaded:', behaviorData);
    }
  } catch (error) {
    console.warn('Could not load behavior data:', error);
  }
  
  win.innerHTML = `
    <div class="app-header">
      <span style="display: flex; align-items: center; gap: 8px;">
        <img src="METAMEDIA/League-of-Legends-Logo-2008.png" style="width: 20px; height: 20px;" alt="LoL">
        LoL ID Archive
      </span>
      <button class="close-app">√ó</button>
    </div>

    <div class="app-body" style="padding: 20px; overflow-y: auto;">
      <div style="text-align: center; margin-bottom: 20px;">
        <h2 style="color: #00ffff; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0,255,255,0.8);">Riot ID Statistics</h2>
        <div style="font-size: 18px; color: #fff; margin-bottom: 5px;">${summonerName}<span style="color: #888;">#${tagLine}</span></div>
        <div style="font-size: 14px; color: #aaa;">Level ${level}</div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
        <div style="background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 8px; padding: 15px; text-align: center;">
          <div style="font-size: 12px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Rank</div>
          <div style="font-size: 16px; color: #00ffff; font-weight: bold; text-shadow: 0 0 8px rgba(0,255,255,0.6);">${rank}</div>
        </div>
        <div style="background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 8px; padding: 15px; text-align: center;">
          <div style="font-size: 12px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">LP</div>
          <div style="font-size: 16px; color: #00ffff; font-weight: bold; text-shadow: 0 0 8px rgba(0,255,255,0.6);">${lp}</div>
        </div>
      </div>

      <div style="background: rgba(0, 255, 255, 0.05); border: 2px solid rgba(0, 255, 255, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
        <div style="font-size: 14px; color: #00ffff; text-transform: uppercase; margin-bottom: 15px; text-align: center; font-weight: bold;">Match Statistics</div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
          <div>
            <div style="font-size: 20px; color: #00ff00; font-weight: bold; margin-bottom: 5px;">${wins}</div>
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase;">Wins</div>
          </div>
          <div>
            <div style="font-size: 20px; color: #ff6b6b; font-weight: bold; margin-bottom: 5px;">${losses}</div>
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase;">Losses</div>
          </div>
          <div>
            <div style="font-size: 20px; color: #00ffff; font-weight: bold; margin-bottom: 5px;">${winRate}%</div>
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase;">Win Rate</div>
          </div>
        </div>
      </div>

      ${behaviorData && !behaviorData.fallback ? `
      <div style="background: rgba(138, 43, 226, 0.1); border: 2px solid rgba(138, 43, 226, 0.4); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
        <div style="font-size: 14px; color: #ba8bff; text-transform: uppercase; margin-bottom: 15px; text-align: center; font-weight: bold;">‚ö° Behavior Patterns</div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
          ${behaviorData.killParticipation ? `
          <div style="background: rgba(138, 43, 226, 0.05); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 8px; padding: 12px; text-align: center;">
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Kill Participation</div>
            <div style="font-size: 16px; color: #ba8bff; font-weight: bold;">${behaviorData.killParticipation}</div>
          </div>
          ` : ''}
          ${behaviorData.goldPerMinute ? `
          <div style="background: rgba(138, 43, 226, 0.05); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 8px; padding: 12px; text-align: center;">
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Gold / Min</div>
            <div style="font-size: 16px; color: #ba8bff; font-weight: bold;">${behaviorData.goldPerMinute}</div>
          </div>
          ` : ''}
          ${behaviorData.visionPerMinute ? `
          <div style="background: rgba(138, 43, 226, 0.05); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 8px; padding: 12px; text-align: center;">
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Vision / Min</div>
            <div style="font-size: 16px; color: #ba8bff; font-weight: bold;">${behaviorData.visionPerMinute}</div>
          </div>
          ` : ''}
          ${behaviorData.matchesPerSession ? `
          <div style="background: rgba(138, 43, 226, 0.05); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 8px; padding: 12px; text-align: center;">
            <div style="font-size: 11px; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">Matches / Session</div>
            <div style="font-size: 16px; color: #ba8bff; font-weight: bold;">${behaviorData.matchesPerSession}</div>
          </div>
          ` : ''}
        </div>
        ${behaviorData.primaryRole ? `
        <div style="text-align: center; margin-top: 10px;">
          <span style="font-size: 11px; color: #aaa; text-transform: uppercase;">Primary Role: </span>
          <span style="font-size: 12px; color: #ba8bff; font-weight: bold;">${behaviorData.primaryRole}</span>
        </div>
        ` : ''}
        ${behaviorData.topChampions && behaviorData.topChampions.length > 0 ? `
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(138, 43, 226, 0.3);">
          <div style="font-size: 11px; color: #aaa; text-transform: uppercase; text-align: center; margin-bottom: 8px;">Top Champions</div>
          <div style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
            ${behaviorData.topChampions.map(champ => `
              <div style="background: rgba(138, 43, 226, 0.1); border: 1px solid rgba(138, 43, 226, 0.4); border-radius: 6px; padding: 6px 12px;">
                <span style="font-size: 10px; color: #888;">#${champ.rank}</span>
                <span style="font-size: 11px; color: #ba8bff; font-weight: bold; margin-left: 4px;">${champ.name}</span>
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}
        ${behaviorData.totalTimePlayed ? `
        <div style="text-align: center; margin-top: 10px; font-size: 10px; color: #888;">
          Total Time Played: ${behaviorData.totalTimePlayed}
        </div>
        ` : ''}
      </div>
      ` : ''}

      <div style="background: rgba(0, 255, 255, 0.05); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 8px; padding: 15px;">
        <div style="font-size: 12px; color: #aaa; text-align: center; line-height: 1.5;">
          <div style="margin-bottom: 8px;">üìä Statistics page showing your Riot ID performance metrics${behaviorData && !behaviorData.fallback ? ' with behavior patterns from LeagueOfGraphs' : ''}.</div>
          <div style="font-size: 10px; color: #666;">Data synced from your League of Legends profile</div>
        </div>
      </div>
    </div>
  `;
}


  // ‚úÖ append window inside the mini-pc-screen, not global body
  document.querySelector('.mini-pc-screen').appendChild(win);

  // üîª close-button logic
  win.querySelector('.close-app').addEventListener('click', () => win.remove());
}

//======MiniApps End==========================================================


  //======================================================
  </script>

</body>
</html>
